
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>Airsim ç¬”è®°ï¼šPython API æ€»ç»“ | Cold Rain&#39;s Blog</title>
    <meta name="author" content="ColdRain" />
    <meta name="description" content="éŠ€ã®é¾ã®èƒŒã«ä¹—ã£ã¦..." />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/head.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/vs.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜ æµè§ˆå™¨é»˜è®¤å¼€å¯</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>COLD RAIN&#39;S BLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Homepage</span>
        </a>
        
        <a href="/2024/11/26/test">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories/%E6%9D%82%E8%B0%88">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags/%E6%9D%82%E8%B0%88">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/friends">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;COLD RAIN&#39;S BLOG</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Homepage</div>
                    </div>
                </a>
                
                <a href="/2024/11/26/test">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories/%E6%9D%82%E8%B0%88">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags/%E6%9D%82%E8%B0%88">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
                <a href="/friends">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-link fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    
    
        <!-- post éƒ¨åˆ†è®¾è®¡ -->

        <div class="article-wrap">

            
            <div class="article-content">
                
                <div>
                    <h1>Airsim ç¬”è®°ï¼šPython API æ€»ç»“</h1>
                </div>

                <div class="info">
                    <span class="date">
                        <span class="icon">
                            <i class="fa-solid fa-calendar fa-fw"></i>
                        </span>
                        2025/4/13
                    </span>

                    
                        <span class="category">
                            <a href="/categories/%E9%A3%9F%E7%94%A8%E6%8C%87%E5%8D%97/">
                                <span class="icon">
                                    <i class="fa-solid fa-bookmark fa-fw"></i>
                                </span>
                                é£Ÿç”¨æŒ‡å—
                            </a>
                        </span>
                    

                    
                        <span class="tags">
                            <span class="icon">
                                <i class="fa-solid fa-tags fa-fw"></i>
                            </span>
                            
                            
                                <span class="tag">
                                    
                                    <a href="/tags/%E4%BB%BF%E7%9C%9F/" style="color: #00a596">
                                        ä»¿çœŸ
                                    </a>
                                </span>
                            
                        </span>
                    
                </div>

                
                    <!-- æ˜¾ç¤ºæ–‡ç« ç‰¹æœ‰çš„æ¨¡å—ï¼ˆå¦‚æ ‡ç­¾ã€åˆ†ç±»ï¼‰ -->
                    <div class="content" v-pre>
                        
                        <blockquote>
<p>ğŸ“š å°ç”Ÿçš„ç¬”è®°å‚è€ƒè¥¿æ¹–å¤§å­¦å®å­å®‰å¤§ä½¬çš„æ•™ç¨‹ï¼š<a target="_blank" rel="noopener" href="https://www.zhihu.com/column/multiUAV">https://www.zhihu.com/column/multiUAV</a></p>
<p>å¦ï¼šæœ¬æ–‡å†…å®¹å‡åœ¨ Windows æ“ä½œç³»ç»Ÿä¸‹è¿›è¡Œï¼ˆUbuntu ä¸‹çš„ä»¿çœŸç¯å¢ƒæŠ˜è…¾èµ·æ¥æ¯”è¾ƒéº»çƒ¦ ğŸ’¦ï¼‰</p>
</blockquote>
<h2><span id="0-airsim-apis-ç®€ä»‹">0. AirSim APIs ç®€ä»‹</span></h2>
<hr>
<p>AirSim å°è£…äº†ä¸€äº› API æ¥å£ï¼Œä½¿ç”¨è¿™äº› API æ¥å£ï¼Œå¯ä»¥ç”¨ç¨‹åºè·Ÿä»¿çœŸè¿›è¡Œäº¤äº’ã€‚ä¾‹å¦‚å¯ä»¥ä½¿ç”¨ API æ¥è·å–å›¾ç‰‡ã€æ— äººæœºçŠ¶æ€ã€æ§åˆ¶æ— äººæœº/è½¦è¾†çš„è¿åŠ¨ç­‰ã€‚</p>
<p>AirSim çš„ API éå¸¸ä¸°å¯Œï¼Œæœ‰å¾ˆå¤šå¯ä»¥è°ƒç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥å°†è¿™äº›åŠŸèƒ½åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š</p>
<ul>
<li><strong>å›¾åƒç±» API</strong>ï¼šè·å–å„ç§ç±»å‹çš„å›¾åƒã€æ§åˆ¶äº‘å°ç­‰ï¼›</li>
<li><strong>æ§åˆ¶ä»¿çœŸè¿è¡Œ</strong>ï¼šå¯ä»¥æ§åˆ¶ä»¿çœŸæš‚åœæˆ–ç»§ç»­ï¼›</li>
<li><strong>ç¢°æ’ API</strong>ï¼šè·å–ç¢°æ’ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¢°æ’æ¬¡æ•°ã€ä½ç½®ã€è¡¨é¢ä¿¡æ¯ã€æ¸—é€æ·±åº¦ç­‰ï¼›</li>
<li><strong>ç¯å¢ƒæ—¶é—´ API</strong>ï¼šä¸»è¦æ˜¯æ§åˆ¶å¤ªé˜³åœ¨å¤©ç©ºä¸­çš„ä½ç½®ï¼›</li>
<li><strong>ç¯å¢ƒå¤©æ°” API</strong>ï¼šæ§åˆ¶ç¯å¢ƒä¸­çš„å¤©æ°”ï¼šä¸‹é›¨ã€é›ªã€ç°å°˜ã€é›¾æ°”ã€é“è·¯æ¹¿æ»‘ç¨‹åº¦ç­‰ï¼›</li>
<li><strong>ç¯å¢ƒé£ API</strong>ï¼šæ§åˆ¶ç¯å¢ƒä¸­çš„é£é€Ÿå’Œé£å‘ç­‰ï¼›</li>
<li><strong>é›·è¾¾ API</strong>ï¼šæ·»åŠ å’Œæ§åˆ¶ç¯å¢ƒä¸­çš„é›·è¾¾ä¼ æ„Ÿå™¨ï¼›</li>
<li><strong>æ— äººæœºæˆ–è½¦è¾†çš„ API</strong>ï¼šæ§åˆ¶è¿åŠ¨ã€è·å–çŠ¶æ€ç­‰</li>
</ul>
<p>AirSim çš„ API æœ‰ python å’Œ C++ ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„ä¹ æƒ¯ä»»æ„é€‰æ‹©ï¼Œè¿™é‡Œä¸»è¦è®°å½• python çš„ä½¿ç”¨æ–¹å¼ã€‚</p>
<p>åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£… <code>msgpack-rpc-python</code> å’Œ <code>airsim</code> ä¸¤ä¸ªåº“å³å¯ä½¿ç”¨</p>
<pre><code class="language-bash">pip install msgpack-rpc-python
pip install airsim
</code></pre>
<h2><span id="1-æ§åˆ¶æ— äººæœºçš„èµ·é£å’Œé™è½">1. æ§åˆ¶æ— äººæœºçš„èµ·é£å’Œé™è½</span></h2>
<hr>
<p>å…ˆçœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>
<pre><code class="language-python">import airsim

# connect to the AirSim simulator
client = airsim.MultirotorClient()
client.confirmConnection()

# get control
client.enableApiControl(True)

# unlock
client.armDisarm(True)

# Async methods returns Future. Call join() to wait for task to complete.
client.takeoffAsync().join()
client.landAsync().join()

# lock
client.armDisarm(False)

# release control
client.enableApiControl(False)
</code></pre>
<blockquote>
<p>åœ¨è¿è¡Œä¸Šé¢è¿™æ®µä»£ç ä¹‹å‰ï¼Œéœ€è¦å…ˆå°† AirSim è¿è¡Œèµ·æ¥ã€‚</p>
<p>å…ˆå°† <code>C:\Users\[ç”¨æˆ·å]\Documents\AirSim</code> è·¯å¾„ä¸‹çš„ <code>settings.json</code> æ–‡ä»¶ä¸­çš„ä»¿çœŸæ¨¡å¼æ”¹ä¸ºå¤šæ—‹ç¿¼ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<pre><code class="language-json">&#123;
    &quot;SettingsVersion&quot;: 1.2,
    &quot;SimMode&quot;: &quot;Multirotor&quot;
&#125;
</code></pre>
<p>ä¿®æ”¹å®Œæˆåï¼Œæ‰“å¼€ä¹‹å‰å®‰è£…å¥½çš„ <code>LandscapeMountains</code> ç¯å¢ƒç›®å½•ä¸‹çš„ <code>LandscapeMountains.sln</code> æ–‡ä»¶ï¼›Visual Studio ä¸­ï¼Œé€‰æ‹©ç¼–è¾‘æ¨¡å¼ä¸º <code>Debug Game Editor</code> å’Œ <code>win64</code>ï¼Œç¡®ä¿ <code>LandscapeMountains</code> ä¸ºå¯åŠ¨é¡¹ç›®ã€‚</p>
<p>ç„¶åç‚¹å‡» <code>æœ¬åœ°Windowsè°ƒè¯•å™¨</code>ï¼Œè¿™æ—¶å°±ä¼šæ‰“å¼€ Unreal Editorï¼›åœ¨ Unreal Editor ä¸­ç‚¹å‡» <code>æ’­æ”¾(Play)</code> æŒ‰é’®ï¼Œä»¿çœŸå¼€å§‹è¿è¡Œã€‚</p>
<p>æ— äººæœºåˆå§‹ä½ç½®è®¾ç½®çš„æ˜¯åœ¨ç©ºä¸­ï¼Œæ‰€ä»¥åˆšä¸€ç‚¹å‡»<code>æ’­æ”¾</code>æŒ‰é’®æ—¶ï¼Œæ— äººæœºä¼šå‘ä¸‹è½ï¼Œæœ€åè§¦åœ°ï¼ŒåŒæ—¶æœºç¿¼ä¹Ÿä¸€ç›´æ—‹è½¬ã€‚å› ä¸ºæœ‰ä¸¤ä¸ªç‰©ä½“çš„ç¢°æ’ï¼Œæ‰€ä»¥ç”»é¢ä¸­ç»™å‡ºäº†ä¸€ä¸ªç¢°æ’è­¦å‘Šã€‚ï¼ˆåˆå§‹ä½ç½®æ˜¯å¯ä»¥è‡ªå·±è°ƒçš„ï¼‰</p>
<p>æ³¨æ„ï¼Œåœ¨ <code>LandscapeMountain</code> è¿™ä¸ªç¯å¢ƒä¸­ï¼Œæ°´é¢å°±æ˜¯ä¸€ä¸ªç‰©ä½“ï¼Œå®ƒè·ŸçŸ³å¤´ã€æ ‘æœ¨ç­‰æœ‰ç›¸åŒçš„ç‰©ç†ç‰¹æ€§ï¼Œæ‰€ä»¥æ— äººæœºä¸ä¼šè½åˆ°æ°´ä¸­ï¼Œè€Œæ˜¯åœ¨ç¡çœ ï¼Œå°±åƒåœ¨å¹³åœ°ä¸Šç€é™†ä¸€æ ·ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªç¯å¢ƒä¸­çš„ä»¿çœŸï¼Œå°±å¯ä»¥æŠŠæ°´é¢å½“åšå¹³åœ°æ¥çœ‹å¾…ã€‚</p>
</blockquote>
<p>ä»£ç è¯¦è§£ï¼š</p>
<pre><code class="language-python">client = airsim.MultirotorClient()
</code></pre>
<p>ä¸ AirSim å»ºç«‹è¿æ¥ï¼Œå¹¶ä¸”è¿”å›å¥æŸ„ï¼ˆclientï¼‰ï¼Œåé¢çš„æ¯æ¬¡æ“ä½œéœ€è¦ä½¿ç”¨è¿™ä¸ªå¥æŸ„ã€‚</p>
<p>å¦‚æœæ˜¯æ±½è½¦ä»¿çœŸï¼Œä»£ç æ˜¯ï¼š<code>client = airsim.CarClient()</code>ï¼›</p>
<pre><code class="language-python">client.confirmConnection()
</code></pre>
<p>æ£€æŸ¥é€šä¿¡æ˜¯å¦å»ºç«‹æˆåŠŸï¼Œå¹¶ä¸”ä¼šåœ¨å‘½ä»¤è¡Œä¸­æ‰“å°è¿æ¥æƒ…å†µï¼Œè¿™æ ·å°±å¯ä»¥åˆ¤æ–­ç¨‹åºæ˜¯å¦å’Œ AirSim è¿æ¥æ­£å¸¸ï¼Œå¦‚æœè¿æ¥æ­£å¸¸ä¼šåœ¨å‘½ä»¤è¡Œä¸­æ‰“å°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-Terminal">Connected!
Client Ver:1 (Min Req: 1), Server Ver:1 (Min Req: 1)
</code></pre>
<pre><code class="language-python">client.enableApiControl(True)   # get control
client.enableApiControl(False)  # release control
</code></pre>
<p>å› ä¸ºå®‰å…¨é—®é¢˜ï¼Œ API æ§åˆ¶é»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œé¥æ§å™¨æœ‰å…¨éƒ¨çš„æ§åˆ¶æƒé™ã€‚æ‰€ä»¥å¿…é¡»è¦åœ¨ç¨‹åºä¸­ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥è·å–æ§åˆ¶æƒã€‚é¥æ§å™¨çš„æ“ä½œä¼šæŠ¢å¤º API çš„æ§åˆ¶æƒï¼ŒåŒæ—¶è®© API è·å–çš„æ§åˆ¶æƒå¤±æ•ˆã€‚ä½¿ç”¨ <code>isApiControlEnabled</code> å¯æ£€æŸ¥ API æ˜¯å¦å…·æœ‰æ§åˆ¶æƒã€‚</p>
<p>å¯èƒ½ä¼šæœ‰äººé—®ä¸ºä»€ä¹ˆæœ€åç»“æŸçš„æ—¶å€™è¦é‡Šæ”¾æ§åˆ¶æƒï¼Œåæ­£éƒ½æ˜¯ä»¿çœŸï¼Œç»“æŸä»¿çœŸå°±å¥½äº†ã€‚ä½†æ˜¯å®é™…ä¸Š AirSim çš„å¼€å‘äººå‘˜å¸Œæœ›åœ¨ä»¿çœŸä¸­çš„ä»£ç å¯ä»¥ç›´æ¥ç§»åˆ°ç°å®ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥å¯¹äºç°å®ä¸­çš„å®‰å…¨é—®é¢˜ï¼Œè¿˜æ˜¯å¼€å‘äº†è·å–æ§åˆ¶æƒå’Œé‡Šæ”¾æ§åˆ¶æƒã€è§£é”å’Œä¸Šé”ç­‰ä¸€ç³»åˆ—å®‰å…¨æ“ä½œã€‚</p>
<pre><code class="language-python">client.takeoffAsync().join()    # èµ·é£
client.landAsync().join()   # é™è½
</code></pre>
<p>è¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥è®©æ— äººæœºèµ·é£å’Œé™è½ã€‚</p>
<p>å¾ˆå¤šæ— äººæœºæˆ–è€…æ±½è½¦æ§åˆ¶çš„å‡½æ•°éƒ½æœ‰ <code>Async</code> ä½œä¸ºåç¼€ï¼Œè¿™äº›å‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šç«‹å³è¿”å›ï¼Œè¿™æ ·çš„è¯ï¼Œè™½ç„¶ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä½†æ˜¯ç¨‹åºå¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹å»ï¼Œè€Œä¸ç”¨ç­‰å¾…è¿™ä¸ªå‡½æ•°çš„ä»»åŠ¡åœ¨ä»¿çœŸä¸­æœ‰æ²¡æœ‰æ‰§è¡Œå®Œã€‚</p>
<p>å¦‚æœä½ æƒ³è®©ç¨‹åºåœ¨è¿™é‡Œç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œï¼Œåˆ™åªéœ€è¦åœ¨åé¢åŠ ä¸Š <code>.join()</code>ã€‚æœ¬ä¾‹å­å°±æ˜¯è®©ç¨‹åºåœ¨è¿™é‡Œç­‰å¾…æ— äººæœºèµ·é£ä»»åŠ¡å®Œæˆï¼Œç„¶åå†æ‰§è¡Œé™è½ä»»åŠ¡ã€‚</p>
<p>æ–°çš„ä»»åŠ¡ä¼šæ‰“æ–­ä¸Šä¸€ä¸ªæ²¡æœ‰æ‰§è¡Œå®Œçš„ä»»åŠ¡ï¼Œæ‰€ä»¥å¦‚æœ <code>takeoff</code> å‡½æ•°æ²¡æœ‰åŠ  <code>.join()</code>ï¼Œåˆ™æœ€åçš„è¡¨ç°æ˜¯æ— äººæœºè¿˜æ²¡æœ‰èµ·é£å°±é™è½äº†ï¼Œæ— äººæœºæ˜¯ä¸ä¼šèµ·é£çš„ã€‚</p>
<blockquote>
<p><strong>Python ä¸ AirSim çš„é€šä¿¡æœºåˆ¶</strong></p>
<p>AirSim API ä½¿ç”¨çš„æ˜¯ <code>TCP/IP</code> ä¸­çš„ <code>msgpack-rpc</code> åè®®ï¼Œè¿™æ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œæ‰€ä»¥å¦‚æœè®¾ç½®æ­£ç¡®ï¼Œå…¶å®å¯ä»¥ç”¨ä¸¤å°ä¸åŒçš„ç”µè„‘æ¥åšä»¿çœŸï¼Œä¸€å°è·‘ AirSim å’Œ Unrealï¼Œå¦ä¸€å°è·‘ python ç¨‹åºã€‚</p>
<p>å½“ AirSim å¼€å§‹ä»¿çœŸçš„æ—¶å€™ï¼Œä¼šæ‰“å¼€ 41451 ç«¯å£ï¼Œå¹¶ç›‘å¬è¿™ä¸ªç«¯å£çš„éœ€æ±‚ã€‚python ç¨‹åºä½¿ç”¨ <code>msgpack serialization</code> æ ¼å¼å‘è¿™ä¸ªç«¯å£å‘é€ RPC åŒ…ï¼Œå°±å¯ä»¥ä¸ AirSim è¿›è¡Œé€šä¿¡äº†ã€‚</p>
</blockquote>
<h2><span id="2-æ§åˆ¶å››æ—‹ç¿¼çš„é£è¡Œcore-api">2. æ§åˆ¶å››æ—‹ç¿¼çš„é£è¡Œï¼ˆcore APIï¼‰</span></h2>
<hr>
<h3><span id="21-æ§åˆ¶æ ·ä¾‹">2.1 æ§åˆ¶æ ·ä¾‹</span></h3>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="language-python">import airsim
import time

# connect to the Airsim simulator
client = airsim.MultirotorClient()

client.enableApiControl(True)   # get control
client.armDisarm(True)          # unlock
client.takeoffAsync().join()    # takeoff

# square flight
client.moveToZAsync(-3, 1).join()               # ä¸Šå‡åˆ° 3m é«˜åº¦
client.moveToPositionAsync(5, 0, -3, 1).join()  # é£åˆ°ï¼ˆ5, 0ï¼‰ç‚¹åæ ‡
client.moveToPositionAsync(5, 5, -3, 1).join()  # é£åˆ°ï¼ˆ5, 5ï¼‰ç‚¹åæ ‡
client.moveToPositionAsync(0, 5, -3, 1).join()  # é£åˆ°ï¼ˆ0, 5ï¼‰ç‚¹åæ ‡
client.moveToPositionAsync(0, 0, -3, 1).join()  # é£åˆ°ï¼ˆ0, 0ï¼‰ç‚¹åæ ‡

client.landAsync().join()       # land
client.armDisarm(False)         # lock
client.enableApiControl(False)  # release control
</code></pre>
<p>ä¸Šé¢è¿™æ®µä»£ç å®ç°çš„æ•ˆæœæ˜¯ï¼š</p>
<ul>
<li>ç¬¬ä¸€é˜¶æ®µï¼šèµ·é£</li>
<li>ç¬¬äºŒé˜¶æ®µï¼šä¸Šå‡åˆ° 3m é«˜åº¦</li>
<li>ç¬¬ä¸‰é˜¶æ®µï¼šé£æ­£æ–¹å½¢
<ul>
<li>å‘å‰é£ 5mï¼ˆæ²¿ x è½´æ­£æ–¹å‘ï¼‰</li>
<li>å‘å³é£ 5m</li>
<li>å‘åé£ 5m</li>
<li>å‘å·¦é£ 5mï¼Œå›åˆ°èµ·é£ç‚¹</li>
</ul>
</li>
<li>ç¬¬å››é˜¶æ®µï¼šé™è½</li>
</ul>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼Œå¦‚æœä½ çš„ä»¿çœŸåœ¨åˆšå¼€å§‹çš„æ—¶å€™ï¼Œå››æ—‹ç¿¼å¹¶ä¸æ˜¯æ­£å‰æ–¹ï¼Œè¯´æ˜ player start çš„ä½ç½®æ˜¯æœ‰è§’åº¦çš„ï¼Œå°†å…¶æ”¹æˆ 0 å³å¯ã€‚</p>
</blockquote>
<p>ä»£ç è¯¦è§£ï¼š</p>
<pre><code class="language-python">client.moveToZAsync(-3, 1).join()   # é«˜åº¦æ§åˆ¶
</code></pre>
<p><code>moveToAsync(z, velocity)</code> æ˜¯é«˜åº¦æ§åˆ¶ APIï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<strong>é«˜åº¦</strong>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯<strong>é€Ÿåº¦</strong>ã€‚å®ç°çš„æ•ˆæœæ˜¯æ— äººæœºä»¥ 1m/s çš„é€Ÿåº¦é£åˆ° 3m é«˜ã€‚<code>.join()</code> åç¼€çš„æ„æ€æ˜¯ç¨‹åºåœ¨è¿™é‡Œç­‰å¾…ç›´åˆ°ä»»åŠ¡å®Œæˆï¼Œä¹Ÿå°±æ˜¯å››æ—‹ç¿¼è¾¾åˆ° 3m çš„é«˜åº¦ã€‚å¦‚æœä¸åŠ  <code>.join()</code> åç¼€ï¼Œåˆ™ä¸ç”¨ç­‰å¾…ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œå‡½æ•°ç›´æ¥è¿”å›ï¼Œç¨‹åºç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p>
<pre><code class="language-python">client.moveToPositionAsync(5, 0, -3, 1).join()  # é£åˆ°ï¼ˆ5, 0ï¼‰ç‚¹åæ ‡
client.moveToPositionAsync(5, 5, -3, 1).join()  # é£åˆ°ï¼ˆ5, 5ï¼‰ç‚¹åæ ‡
client.moveToPositionAsync(0, 5, -3, 1).join()  # é£åˆ°ï¼ˆ0, 5ï¼‰ç‚¹åæ ‡
client.moveToPositionAsync(0, 0, -3, 1).join()  # é£åˆ°ï¼ˆ0, 0ï¼‰ç‚¹åæ ‡
</code></pre>
<p><code>moveToPositionAsync(x, y, z, velocity)</code> æ˜¯æ°´å¹³ä½ç½®æ§åˆ¶ APIï¼Œ<code>x, y, z</code> æ˜¯å…¨å±€åæ ‡ä½ç½®ï¼Œ<code>velocity</code> æ˜¯é€Ÿåº¦ã€‚å®ç°çš„æ•ˆæœæ˜¯ä»¥ 1m/s çš„é€Ÿåº¦é£åˆ° (5, 0) ç‚¹ï¼Œ3m é«˜çš„ä½ç½®ã€‚<code>.join()</code> åç¼€çš„æ„æ€æ˜¯ç¨‹åºåœ¨è¿™é‡Œç­‰å¾…ç›´åˆ°ä»»åŠ¡å®Œæˆï¼Œä¹Ÿå°±æ˜¯å››æ—‹ç¿¼åˆ°è¾¾ç›®æ ‡ä½ç½®ç‚¹ï¼ŒåŒæ—¶åˆ°è¾¾è®¾ç½®çš„é«˜åº¦ã€‚å¦‚æœä¸åŠ  <code>.join()</code> åç¼€ï¼Œåˆ™ä¸ç”¨ç­‰å¾…ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œå‡½æ•°ç›´æ¥è¿”å›ï¼Œç¨‹åºç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p>
<h3><span id="22-å››æ—‹ç¿¼åº•å±‚é£æ§é€šé“ç®€ä»‹">2.2 å››æ—‹ç¿¼åº•å±‚é£æ§é€šé“ç®€ä»‹</span></h3>
<p>å…³äºå››æ—‹ç¿¼çš„éçº¿æ€§å»ºæ¨¡å’Œåº•å±‚æ§åˆ¶å™¨è®¾è®¡ï¼Œåœ¨åé¢è¯¦ç»†è®²è§£ï¼Œç›®å‰å…ˆç®€å•ä»‹ç»ä¸€ä¸‹å››æ—‹ç¿¼çš„åº•å±‚é£æ§å¯ä»¥æ§åˆ¶ä»€ä¹ˆé‡ã€‚å½“å››æ—‹ç¿¼ä½é€Ÿé£è¡Œæ—¶ï¼Œå…¶åº•å±‚é£æ§å¯ä»¥è§£è€¦ä¸º 3 ä¸ªé€šé“ï¼š</p>
<ul>
<li>æ°´å¹³é€šé“</li>
<li>é«˜åº¦é€šé“</li>
<li>åèˆªé€šé“</li>
</ul>
<p>è¿™ 3 ä¸ªé€šé“å¯ä»¥åˆ†åˆ«æ§åˆ¶ï¼Œå¯ä»¥ç†è§£ä¸ºé€šé“ä¹‹é—´ç›¸äº’ä¸ä¼šå½±å“ã€‚æ°´å¹³é€šé“å¯ä»¥æ§åˆ¶å››æ—‹ç¿¼çš„æ°´å¹³ä½ç½®ã€æ°´å¹³é€Ÿåº¦ã€æ°´å¹³å§¿æ€è§’ï¼›é«˜åº¦é€šé“å¯ä»¥æ§åˆ¶å‚ç›´é«˜åº¦ã€å‚ç›´é€Ÿåº¦ã€å‚ç›´åŠ é€Ÿåº¦ï¼›åèˆªé€šé“å¯ä»¥æ§åˆ¶åèˆªè§’åº¦ã€åèˆªè§’é€Ÿåº¦ã€åèˆªè§’åŠ é€Ÿåº¦ã€‚</p>
<p>æœ¬æ–‡ä¾‹å­ç¨‹åºä¸­ <code>x, y</code> æ˜¯æ°´å¹³é€šé“çš„æŒ‡ä»¤ï¼Œæ§åˆ¶å››æ—‹ç¿¼æ°´å¹³æ–¹å‘çš„é£è¡Œï¼›<code>z</code> æ˜¯é«˜åº¦é€šé“æŒ‡ä»¤ï¼Œæ§åˆ¶å››æ—‹ç¿¼çš„é«˜åº¦ã€‚æœ¬æ–‡ä¾‹å­ç¨‹åºä¸­æ²¡æœ‰åèˆªé€šé“æŒ‡ä»¤ï¼Œé»˜è®¤çš„åèˆªæ˜¯ 0ï¼Œä¹Ÿå°±æ˜¯å››æ—‹ç¿¼è‡ªèº«ä¸ä¼šæ°´å¹³æ—‹è½¬ï¼Œå…¶æœå‘å§‹ç»ˆæœå‘å‰æ–¹ã€‚</p>
<h3><span id="23-æ°´å¹³ä½ç½®æ§åˆ¶å‡½æ•°">2.3 æ°´å¹³ä½ç½®æ§åˆ¶å‡½æ•°</span></h3>
<p>å‡½æ•°å®šä¹‰</p>
<pre><code class="language-python">def moveToPositionAsync(
    self,
    x, 
    y,
    z,
    velocity,
    timeout_sec=3e38,
    drivetrain=DrivetrainType.MaxDegreeOfFreedom,
    yaw_mode=YawMode(),
    lookahead=-1,
    adaptive_lookahead=1,
    vehicle_name=&quot;&quot;,
)
</code></pre>
<p>è¾“å…¥å‚æ•°åŒ…æ‹¬ï¼š</p>
<ul>
<li>x, y, zï¼šä½ç½®åæ ‡ï¼ˆå…¨å±€åæ ‡ç³»-åŒ—ä¸œåœ°ï¼‰</li>
<li>velocityï¼šé£è¡Œé€Ÿåº¦ï¼ˆm/sï¼‰</li>
<li>timeout_secï¼šå¦‚æœæ²¡æœ‰ç›¸åº”ï¼Œè¶…æ—¶æ—¶é—´</li>
<li>drivetrain, yaw_modeï¼šè®¾ç½®é£è¡Œæœå‘æ¨¡å¼å’Œ yaw è§’æ§åˆ¶æ¨¡å¼</li>
<li>lookahead, adaptive_lookaheadï¼šè®¾ç½®è·¯å¾„é£è¡Œçš„æ—¶å€™çš„ yaw è§’æ§åˆ¶æ¨¡å¼</li>
<li>vehicle_nameï¼šæ§åˆ¶çš„å››æ—‹ç¿¼çš„åå­—</li>
</ul>
<p><code>x, y, z, velocity</code> è¿™å››ä¸ªå‚æ•°æ˜¯å¿…é¡»è¦è®¾ç½®çš„é‡ï¼ŒæŒ‡ç¤ºå››æ—‹ç¿¼ä»¥å¤šå¤§çš„é€Ÿåº¦é£å¾€å“ªä¸ªåæ ‡ç‚¹ã€‚åé¢çš„å‡ ä¸ªå‚æ•°éƒ½æœ‰å…¶é»˜è®¤å€¼ï¼Œä¸ç”¨è®¾ç½®ä¹Ÿå¯ä»¥ã€‚</p>
<p><code>lookahead</code> å’Œ <code>adaptive_lookahead</code> è¿™ä¸¤ä¸ªå‚æ•°æ˜¯è®¾ç½®å½“å››æ—‹ç¿¼é£è½¨è¿¹çš„æ—¶å€™çš„æœå‘ï¼Œç›®å‰è¿˜ç”¨ä¸åˆ°ã€‚</p>
<p><code>vehicle_name</code> æ˜¯æŒ‡å°†æŒ‡ä»¤å‘é€ç»™å“ªä¸ªå››æ—‹ç¿¼ï¼Œå½“åšå¤šä¸ªå››æ—‹ç¿¼ååŒé£è¡Œæ§åˆ¶çš„æ—¶å€™ï¼Œè¿™ä¸ªå‚æ•°å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œåé¢ä¼šæœ‰å¤šæœºååŒç¼–é˜Ÿçš„å†…å®¹ã€‚</p>
<p><code>drivetrain</code> å’Œ <code>yaw_mode</code> è¿™ä¸¤ä¸ªå‚æ•°çš„ç»„åˆå¯ä»¥è®¾ç½®å››æ—‹ç¿¼çš„åèˆªè§’æ§åˆ¶æ¨¡å¼ï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»ã€‚</p>
<h3><span id="24-åèˆªè§’æ§åˆ¶æ¨¡å¼è¯¦è§£">2.4 åèˆªè§’æ§åˆ¶æ¨¡å¼è¯¦è§£</span></h3>
<p>drivetrain å‚æ•°å¯ä»¥è®¾ç½®ä¸ºä¸¤ä¸ªé‡ï¼š</p>
<ul>
<li><code>airsim.DrivetrainType.ForwardOnly</code>ï¼šå§‹ç»ˆæœå‘é€Ÿåº¦æ–¹å‘</li>
<li><code>airsim.DrivetrainType.MaxDegreeOfFreedom</code>ï¼šæ‰‹åŠ¨è®¾ç½® yaw è§’åº¦</li>
</ul>
<p><code>yaw_mode</code> å¿…é¡»è®¾ç½®ä¸º <code>YawMode()</code> ç±»å‹çš„å˜é‡ï¼Œè¿™ä¸ªç»“æ„ä½“ç±»å‹åŒ…å«ä¸¤ä¸ªå±æ€§ï¼š</p>
<ul>
<li><code>YawMode().is_rate</code>ï¼šTrue - è®¾ç½®è§’é€Ÿåº¦ï¼›False - è®¾ç½®è§’åº¦ã€‚</li>
<li><code>YawMode().yaw_or_rate</code>ï¼šå¯ä»¥æ˜¯ä»»æ„æµ®ç‚¹æ•°</li>
</ul>
<p>ä¸‹é¢åˆ†å‡ ç§æƒ…å†µè®¨è®ºï¼š</p>
<h4><span id="æƒ…å†µ1ä¸å…è®¸">æƒ…å†µ1ï¼ˆä¸å…è®¸ï¼‰</span></h4>
<pre><code class="language-python">drivetrain = airsim.DrivetrainType.ForwardOnly
yaw_mode = airsim.YawMode(True, 0)
client.moveToPositionAsync(x, y, z, velocity, drivetrain=drivetrain, yaw_mode=yaw_mode).join()
</code></pre>
<p>å½“ <code>drivetrain = airsim.DrivetrainType.ForwardOnly</code> æ—¶ï¼Œå››æ—‹ç¿¼å§‹ç»ˆæœå‘å…¶é£è¡Œçš„æ–¹å‘ï¼Œè¿™æ—¶ <code>yaw_mode</code> ä¸å…è®¸è®¾ç½®ä¸º <code>YawMode().is_rate = True</code>ã€‚å› ä¸ºå‰é¢çš„å‚æ•°è¦æ±‚å››æ—‹ç¿¼æœå‘è¿åŠ¨æ–¹å‘ï¼Œè€Œ <code>yaw_mode</code> è¦æ±‚å››æ—‹ç¿¼ä»¥ä¸€å®šçš„è§’é€Ÿåº¦æ—‹è½¬ï¼Œè¿™æ˜¯çŸ›ç›¾çš„ã€‚</p>
<h4><span id="æƒ…å†µ2">æƒ…å†µ2</span></h4>
<pre><code class="language-python">drivetrain = airsim.DrivetrainType.ForwardOnly
yaw_mode = airsim.YawMode(False, 90)
client.moveToPositionAsync(x, y, z, velocity, drivetrain=drivetrain, yaw_mode=yaw_mode).join()
</code></pre>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œå››æ—‹ç¿¼çš„æœå‘å§‹ç»ˆä¸å‰è¿›æ–¹å‘ç›¸å·® 90 åº¦ï¼Œä¹Ÿå°±æ˜¯å››æ—‹ç¿¼å§‹ç»ˆå‘å·¦ä¾§æ–¹å‘è¿åŠ¨ã€‚ä¾‹å¦‚ï¼šå½“å››æ—‹ç¿¼åœ¨ç»•ç€ä¸€ä¸ªåœ†å¿ƒè½¬åœˆæ—¶ï¼Œå…¶æœå‘å§‹ç»ˆæŒ‡å‘åœ†å¿ƒï¼ˆè¿™ç§é£è¡ŒçŠ¶æ€çš„ä»£ç åœ¨åé¢ç»™å‡ºï¼‰ã€‚è¿™é‡Œçš„ 90 åº¦å¯ä»¥ä»»æ„è®¾ç½®ã€‚</p>
<h4><span id="æƒ…å†µ3">æƒ…å†µ3</span></h4>
<pre><code class="language-python">drivetrain = airsim.DrivetrainType.MaxDegreeOfFreedom
yaw_mode = airsim.YawMode(False, 0)
client.moveToPositionAsync(x, y, z, velocity, drivetrain=drivetrain, yaw_mode=yaw_mode).join()
</code></pre>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ç®¡é€Ÿåº¦æ–¹å‘æ˜¯ä»€ä¹ˆï¼Œå››æ—‹ç¿¼çš„ yaw è§’å§‹ç»ˆç­‰äº 0ï¼Œä¹Ÿå°±æ˜¯å…¶æœå‘å§‹ç»ˆæŒ‡å‘æ­£åŒ—æ–¹å‘ã€‚å¦‚æœæ˜¯ 90 åº¦ï¼Œåˆ™å§‹ç»ˆæŒ‡å‘æ­£ä¸œæ–¹å‘ï¼Œè€Œ -90 åº¦ï¼Œåˆ™å§‹ç»ˆæŒ‡å‘æ­£è¥¿æ–¹å‘ã€‚</p>
<h4><span id="æƒ…å†µ4">æƒ…å†µ4</span></h4>
<pre><code class="language-python">drivetrain = airsim.DrivetrainType.MaxDegreeOfFreedom
yaw_mode = airsim.YawMode(True, 10)
client.moveToPositionAsync(x, y, z, velocity, drivetrain=drivetrain, yaw_mode=yaw_mode).join()
</code></pre>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œå››æ—‹ç¿¼ä¸ç®¡é€Ÿåº¦æ–¹å‘æ˜¯ä»€ä¹ˆï¼Œyaw è§’ä»¥ 10 åº¦/ç§’çš„é€Ÿåº¦æ—‹è½¬ã€‚</p>
<p>ä¸‹é¢æ€»ç»“ä¸€ä¸‹è¿™ä¸¤ä¸ªå‚æ•°çš„è®¾ç½®å¯¹æ•ˆæœçš„å½±å“ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>ForwardOnly</th>
<th>MaxDegreeOfFreedom</th>
</tr>
</thead>
<tbody>
<tr>
<td>is_rate=True</td>
<td>ä¸å…è®¸</td>
<td>yaw è§’ä»¥ yaw_or_rate åº¦/ç§’æ—‹è½¬</td>
</tr>
<tr>
<td>is_rate=False</td>
<td>yaw è§’ç›¸å¯¹äºé€Ÿåº¦æ–¹å‘åå·® yaw_or_rate åº¦</td>
<td>yaw è§’ç›¸å¯¹æ­£åŒ—æ–¹å‘åå·® yaw_or_rate åº¦</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>AirSim åæ ‡ç³»å®šä¹‰</strong></p>
<p>ä¸ºä»€ä¹ˆ 0 åº¦æ˜¯æ­£åŒ—æ–¹å‘å‘¢ï¼Œè¿™å°±æ¶‰åŠåˆ°åæ ‡ç³»çš„å®šä¹‰äº†ï¼Œä¸‹é¢å…ˆç®€å•ä»‹ç»ä¸€ä¸‹åæ ‡ç³»çš„å®šä¹‰</p>
<p>Unreal å¼•æ“ä¸­çš„åæ ‡ç³»ä¸ AirSim å®šä¹‰çš„åæ ‡ç³»æ˜¯ä¸åŒçš„ï¼Œç”šè‡³é•¿åº¦å•ä½éƒ½ä¸åŒã€‚Unreal çš„é•¿åº¦å•ä½æ˜¯å˜ç±³ï¼Œè€Œ AirSim çš„é•¿åº¦å•ä½æ˜¯ç±³ã€‚ä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼ŒAirSim å·²ç»éå¸¸å¥½åœ°å¤„ç†äº†è¿™ä¸ªé—®é¢˜ï¼Œä½ ä¸ç”¨åœ¨æ„ Unreal çš„åæ ‡ç³»æ˜¯ä»€ä¹ˆï¼Œåªéœ€è¦æŒ‰ç…§ AirSim çš„åæ ‡ç³»è®¾ç½®å³å¯ï¼ŒAirSim ä¼šå¸®ä½ è‡ªåŠ¨è½¬æ¢çš„ã€‚</p>
<p>æœ¬æ–‡å…ˆè¯´æ˜ä¸¤ä¸ªåæ ‡ç³»çš„å®šä¹‰ï¼š<strong>å…¨å±€åæ ‡ç³»ã€æœºä½“åæ ‡ç³»</strong>ã€‚</p>
<p><strong>å…¨å±€åæ ‡ç³»</strong>æ˜¯å›ºè¿åˆ°å¤§åœ°çš„ï¼Œx, y, z ä¸‰ä¸ªåæ ‡è½´çš„æŒ‡å‘åˆ†åˆ«æ˜¯åŒ—ã€ä¸œã€åœ°ï¼Œä¹Ÿå°±æ˜¯æœåŒ—æ˜¯ x è½´çš„æ­£æ–¹å‘ï¼Œæœå—æ˜¯ x è½´çš„è´Ÿæ–¹å‘ã€‚å…¨å±€åæ ‡ç³»çš„åŸç‚¹ä½ç½®æ˜¯å¤§åœ°çš„æŸä¸€ç‚¹ï¼ˆå¯ä»¥åœ¨ settings æ–‡ä»¶ä¸­è®¾ç½®ï¼‰ã€‚</p>
<p><strong>æœºä½“åæ ‡ç³»</strong>æ˜¯å›ºè¿åˆ°å››æ—‹ç¿¼æœºèº«çš„ï¼Œx, y, z ä¸‰ä¸ªåæ ‡è½´çš„æŒ‡å‘åˆ†åˆ«æ˜¯å‰ã€å³ã€ä¸‹ï¼Œä¹Ÿå°±æ˜¯é£æœºçš„å‰æ–¹æ˜¯ x è½´çš„æ­£æ–¹å‘ï¼Œé£æœºåæ–¹æ˜¯ x è½´çš„è´Ÿæ–¹å‘ã€‚æœºä½“åæ ‡ç³»çš„åŸç‚¹ä½ç½®æ˜¯æœºä½“çš„é‡å¿ƒä½ç½®ã€‚</p>
</blockquote>
<h2><span id="3-é€Ÿåº¦æ§åˆ¶">3. é€Ÿåº¦æ§åˆ¶</span></h2>
<hr>
<h3><span id="31-æ§åˆ¶æ ·ä¾‹">3.1 æ§åˆ¶æ ·ä¾‹</span></h3>
<p>è€æ ·å­ï¼Œå…ˆä¸Šç¤ºä¾‹ï¼š</p>
<pre><code class="language-python">import airsim
import time

client = airsim.MultirotorClient()  # connect to the AirSim simulator
client.enableApiControl(True)       # è·å¾—æ§åˆ¶æƒ
client.armDisarm(True)              # è§£é”
client.takeoffAsync().join()        # ç¬¬ä¸€é˜¶æ®µï¼šèµ·é£

client.moveToZAsync(-2, 1).join()   # ç¬¬äºŒé˜¶æ®µï¼šä¸Šå‡åˆ° 2m é«˜åº¦

# é£æ­£æ–¹å½¢
client.moveByVelocityZAsync(1, 0, -2, 8).join() # ç¬¬ä¸‰é˜¶æ®µï¼šä»¥ 1m/s é€Ÿåº¦å‘å‰é£ 8 ç§’é’Ÿ
client.moveByVelocityZAsync(0, 1, -2, 8).join() # ç¬¬ä¸‰é˜¶æ®µï¼šä»¥ 1m/s é€Ÿåº¦å‘å³é£ 8 ç§’é’Ÿ
client.moveByVelocityZAsync(-1, 0, -2, 8).join() # ç¬¬ä¸‰é˜¶æ®µï¼šä»¥ 1m/s é€Ÿåº¦å‘åé£ 8 ç§’é’Ÿ
client.moveByVelocityZAsync(0, -1, -2, 8).join() # ç¬¬ä¸‰é˜¶æ®µï¼šä»¥ 1m/s é€Ÿåº¦å‘å·¦é£ 8 ç§’é’Ÿ

# æ‚¬åœ 2 ç§’é’Ÿ
client.hoverAsync().join()      # ç¬¬å››é˜¶æ®µï¼šæ‚¬åœ 6 ç§’
time.sleep(6)

client.landAsync().join()       # ç¬¬äº”é˜¶æ®µï¼šé™è½
client.armDisarm(False)         # ä¸Šé”
client.enableApiControl(False)  # é‡Šæ”¾æ§åˆ¶æƒ
</code></pre>
<blockquote>
<p>åœ¨è§†é¢‘æ¼”ç¤ºçš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½®å›ºå®šè§†è§’æ¥è§‚å¯Ÿå››æ—‹ç¿¼è¿åŠ¨çš„è½¨è¿¹ï¼Œæ–¹æ³•å¦‚ä¸‹ã€‚</p>
<p>ç‚¹å‡» <code>è¿è¡Œ/Play</code> æŒ‰é’®åï¼Œä¸­é—´çš„è§†è§’é»˜è®¤æ˜¯è·Ÿéšè§†è§’ï¼Œè§†è§’çš„è®¾ç½®å†³å®šäº†æ‘„åƒæœºå¦‚ä½•è·Ÿéšå››æ—‹ç¿¼ï¼Œå¯¹äºå››æ—‹ç¿¼æ¥è¯´ï¼Œé»˜è®¤æ˜¯ <code>è·Ÿéš/Flywithme</code> æ¨¡å¼ï¼Œå¯¹äºæ±½è½¦æ¥è¯´ï¼Œé»˜è®¤æ˜¯ <code>SpringArmChase</code> æ¨¡å¼ã€‚ä¸‹é¢åˆ—å‡ºè¿™äº›æ¨¡å¼ï¼š</p>
<ul>
<li><code>è·Ÿéš/FlyWithMe</code>ï¼šä»¥ 6 è‡ªç”±åº¦è·Ÿéšå››æ—‹ç¿¼</li>
<li><code>FPV</code>ï¼šæœºè½½æ‘„åƒå¤´è§†è§’</li>
<li><code>åœ°é¢è§‚å¯Ÿè€…/GroundObserver</code>ï¼šåœ¨åœ°é¢ä¸Šä»¥ XY å¹³é¢è‡ªç”±åº¦è·Ÿéšå››æ—‹ç¿¼</li>
<li><code>æ‰‹åŠ¨/Manual</code>ï¼šæ‰‹åŠ¨è®¾ç½®æ‘„åƒæœºçš„ä½ç½®</li>
<li><code>å¼¹æ€§æœºè‡‚è·Ÿéš/SpringArmChase</code>ï¼šæ‘„åƒæœºå›ºå®šåœ¨ä¸€ä¸ªéšå½¢çš„ä¸æ±½è½¦è¿åœ¨ä¸€èµ·çš„å¼¹æ€§æœºè‡‚ä¸Šï¼Œè·Ÿéšæ±½è½¦ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€äº›æ—¶å»¶ã€‚</li>
<li><code>NoDisplay</code>ï¼šä¸æ˜¾ç¤ºç”»é¢ï¼Œè¿™å¯ä»¥æé«˜æ¸²æŸ“æ€§èƒ½ï¼Œè€Œä¸”ä¸å½±å“ APIs</li>
</ul>
<p>æŠŠé¼ æ ‡ç§»åŠ¨åˆ°ä¸­é—´çš„è§†é‡ä¸­éšä¾¿ä¸€ä¸ªä½ç½®ï¼Œç‚¹ä¸€ä¸‹é¼ æ ‡å·¦é”®ï¼Œè¿™æ—¶é¼ æ ‡å°±æ¶ˆå¤±äº†ã€‚è¿™æ—¶å¯ä»¥è®¾ç½®è§†è§’æ¨¡å¼ï¼š</p>
<ul>
<li><code>F</code> æŒ‰é”®ï¼šFPV</li>
<li><code>B</code> æŒ‰é”®ï¼šè·Ÿéš/FlyWithMe</li>
<li><code>\</code> æŒ‰é”®ï¼šåœ°é¢è§‚å¯Ÿè€…/GroundObserver</li>
<li><code>/</code> æŒ‰é”®ï¼šå¼¹æ€§æœºè‡‚è·Ÿéš/SpringArmChase</li>
<li><code>M</code> æŒ‰é”®ï¼šæ‰‹åŠ¨/Manual</li>
</ul>
<p>æŒ‰ <code>M</code> æŒ‰é”®è¿›å…¥æ‰‹åŠ¨è®¾ç½®æ¨¡å¼ï¼Œå¯ä»¥è®¾ç½®æ‘„åƒæœºçš„ä½ç½®ï¼š</p>
<ul>
<li>æ–¹å‘é”®ï¼šå‰è¿›ã€åé€€ã€å‘å·¦ã€å‘å³ç§»åŠ¨</li>
<li>page up/downï¼šä¸Šä¸‹ç§»åŠ¨</li>
<li>Wï¼ŒS æŒ‰é”®ï¼šä¿¯ä»°è½¬åŠ¨</li>
<li>Aï¼ŒD æŒ‰é”®ï¼šåèˆªè½¬åŠ¨</li>
</ul>
</blockquote>
<h3><span id="32-ä»£ç è¯¦è§£">3.2 ä»£ç è¯¦è§£</span></h3>
<pre><code class="language-python">client.moveByVelocityZAsync(vx, vy, z, duration).join()
</code></pre>
<p>é€Ÿåº¦æ§åˆ¶å‡½æ•°ï¼Œè®©å››æ—‹ç¿¼åœ¨ <code>z</code> çš„é«˜åº¦ï¼Œä»¥ <code>vx</code>ï¼Œ<code>vy</code> çš„é€Ÿåº¦ï¼Œé£è¡Œ <code>duration</code> ç§’ã€‚</p>
<pre><code class="language-python">client.hoverAsync().join()
</code></pre>
<p>è¿™å¥æŒ‡ä»¤çš„åŠŸèƒ½æ˜¯è®©å››æ—‹ç¿¼åœ¨å½“å‰ä½ç½®æ‚¬åœã€‚</p>
<h3><span id="33-é€Ÿåº¦æ§åˆ¶æ–¹æ³•-api">3.3 é€Ÿåº¦æ§åˆ¶æ–¹æ³• API</span></h3>
<pre><code class="language-python">def moveByVelocityZAsync(
    self,
    vx,
    vy,
    z,
    duration,
    drivetrain=DrivetrainType.MaxDegreeOfFreedom,
    yaw_mode=YawMode(),
    vehicle_name=&quot;&quot;,
)
</code></pre>
<h3><span id="34-é€Ÿåº¦æ§åˆ¶è¯¯å·®">3.4 é€Ÿåº¦æ§åˆ¶è¯¯å·®</span></h3>
<p>å››æ—‹ç¿¼æ˜¯ä¸€ä¸ªéçº¿æ€§ç³»ç»Ÿï¼Œç»™ä¸€ä¸ªé€Ÿåº¦æŒ‡ä»¤ï¼Œå®ƒæ˜¯ä¸å¯èƒ½ç¬æ—¶åˆ°è¾¾çš„ï¼Œè€Œä¸”è¿™ä¸ªé€Ÿåº¦æŒ‡ä»¤ä¸å½“å‰çš„é€Ÿåº¦ä¹‹å·®è¶Šå¤§ï¼Œè¾¾åˆ°è¿™ä¸ªé€Ÿåº¦æŒ‡ä»¤çš„è°ƒèŠ‚æ—¶é—´å°±è¶Šé•¿ã€‚æ‰€ä»¥åœ¨ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œæœ€åçš„å››æ—‹ç¿¼å¹¶æ²¡æœ‰å›åˆ°èµ·ç‚¹ä½ç½®ã€‚</p>
<p>ä¸ºäº†åšå¯¹æ¯”ï¼Œå¯ä»¥æŠŠé€Ÿåº¦å¢å¤§ä¸€äº›ï¼Œä¸‹é¢çš„ä»£ç æ˜¯å››æ—‹ç¿¼ä»¥ 8m/s çš„é€Ÿåº¦é£è¡Œ 2 ç§’é’Ÿï¼Œåˆ†åˆ«å‘å‰å³åå·¦å››ä¸ªæ–¹å‘å„é£è¡Œä¸€æ¬¡ï¼Œæœ€åç¦»èµ·ç‚¹ä½ç½®åå·®æ›´å¤§ï¼š</p>
<pre><code class="language-python">import airsim
 import time
 â€‹
 client = airsim.MultirotorClient()  # connect to the AirSim simulator
 client.enableApiControl(True)       # è·å–æ§åˆ¶æƒ
 client.armDisarm(True)              # è§£é”
 client.takeoffAsync().join()        # ç¬¬ä¸€é˜¶æ®µï¼šèµ·é£
 â€‹
 client.moveToZAsync(-2, 1).join()   # ç¬¬äºŒé˜¶æ®µï¼šä¸Šå‡åˆ°2ç±³é«˜åº¦
 â€‹
 # é£æ­£æ–¹å½¢
 client.moveByVelocityZAsync(8, 0, -2, 2).join()     # ç¬¬ä¸‰é˜¶æ®µï¼šä»¥8m/sé€Ÿåº¦å‘å‰é£2ç§’é’Ÿ
 client.moveByVelocityZAsync(0, 8, -2, 2).join()     # ç¬¬ä¸‰é˜¶æ®µï¼šä»¥8m/sé€Ÿåº¦å‘å³é£2ç§’é’Ÿ
 client.moveByVelocityZAsync(-8, 0, -2, 2).join()    # ç¬¬ä¸‰é˜¶æ®µï¼šä»¥8m/sé€Ÿåº¦å‘åé£2ç§’é’Ÿ
 client.moveByVelocityZAsync(0, -8, -2, 2).join()    # ç¬¬ä¸‰é˜¶æ®µï¼šä»¥8m/sé€Ÿåº¦å‘å·¦é£2ç§’é’Ÿ
 â€‹
 # æ‚¬åœ 2 ç§’é’Ÿ
 client.hoverAsync().join()          # ç¬¬å››é˜¶æ®µï¼šæ‚¬åœ6ç§’é’Ÿ
 time.sleep(6)
 â€‹
 client.landAsync().join()           # ç¬¬äº”é˜¶æ®µï¼šé™è½
 client.armDisarm(False)             # ä¸Šé”
 client.enableApiControl(False)      # é‡Šæ”¾æ§åˆ¶æƒ
</code></pre>
<h2><span id="4-å››æ—‹ç¿¼é£åœ†å½¢åŠç”»å›¾-api">4. å››æ—‹ç¿¼é£åœ†å½¢åŠç”»å›¾ API</span></h2>
<hr>
<p>å››æ—‹ç¿¼é£åœ†å½¢å’Œä¹‹å‰å°†çš„é£æ­£æ–¹å½¢æœ‰æœ¬è´¨çš„ä¸åŒï¼Œä¸ºäº†èƒ½å¤Ÿé£ä¸€ä¸ªå®Œç¾çš„åœ†å½¢ï¼Œåªé é£ç‚¹æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦è·å–æ— äººæœºå½“å‰çš„ä½ç½®çŠ¶æ€æ¥è®¡ç®—é€Ÿåº¦æŒ‡ä»¤ã€‚æ¥ä¸‹æ¥ä»‹ç»ä»¥é€Ÿåº¦æŒ‡ä»¤çš„æ–¹å¼ï¼Œè®©å››æ—‹ç¿¼é£ä¸€ä¸ªåœ†å½¢ã€‚</p>
<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">import airsim
import numpy as np
import math
import time

client = airsim.MultirotorClient()
client.enableApiControl(True)
client.armDisarm(True)
client.takeoffAsync().join()
client.moveToZAsync(-3, 1).join()

center = np.array([[0], [5]])   # åœ†å¿ƒè®¾ç½®
speed = 2                       # é€Ÿåº¦è®¾ç½®
radius = 5                      # åŠå¾„è®¾ç½®
clock_wise = True               # é¡ºæ—¶é’ˆæˆ–é€†æ—¶é’ˆè®¾ç½®

pos_reserve = np.array([[0.], [0.], [-3.]])

# é€Ÿåº¦æ§åˆ¶
for i in range(2000):
    # è·å–æ— äººæœºå½“å‰çš„ä½ç½®
    state = client.simGetGroundTruthKinematics()
    pos = np.array([[state.position.x_val], [state.position.y_val], [state.position.z_val]])

    # è®¡ç®—å¾„å‘é€Ÿåº¦çš„æ–¹å‘å‘é‡
    dp = pos[0:2] - center
    if np.linalg.norm(dp) - radius &gt; 0.1:
        vel_dir_1 = -dp
    elif np.linalg.norm(dp) - radius &lt; 0.1:
        vel_dir_1 = dp

    # è®¡ç®—åˆ‡å‘é€Ÿåº¦çš„æ–¹å‘å‘é‡
    theta = math.atan2(dp[1, 0], dp[0, 0])
    if clock_wise:
        # å¦‚æœæ˜¯é¡ºæ—¶é’ˆ
        theta += math.pi/2
    else:
        # å¦‚æœæ˜¯é€†æ—¶é’ˆ
        theta -= math.pi/2
    v_dir_2 = np.array([[math.cos(theta)], [math.sin(theta)]])

    # è®¡ç®—æœ€ç»ˆé€Ÿåº¦çš„æ–¹å‘å‘é‡
    v_dir = 0.08 * vel_dir_1 + v_dir_2

    # è®¡ç®—æœ€ç»ˆé€Ÿåº¦æŒ‡ä»¤
    v_cmd = speed * v_dir/np.linalg.norm(v_dir)

    # é€Ÿåº¦æ§åˆ¶
    client.moveByVelocityZAsync(v_cmd[0, 0], v_cmd[1, 0], -3, 1)

    # ç”»å›¾
    point_reserve = [airsim.Vector3r(pos_reserve[0, 0], pos_reserve[1, 0], pos_reserve[2, 0])]
    point = [airsim.Vector3r(pos[0, 0], pos[1, 0], pos[2, 0])]
    point_end = pos + np.vstack((v_cmd, np.array([[0]])))
    point_end = [airsim.Vector3r(point_end[0, 0], point_end[1, 0], point_end[2, 0])]
    client.simPlotArrows(point, point_end, arrow_size=8.0, color_rgba=[0.0, 0.0, 1.0, 1.0])
    client.simPlotLineList(point_reserve+point, color_rgba=[1.0, 0.0, 0.0, 1.0], is_persistent=True)

    # å¾ªç¯
    pos_reserve = pos
    time.sleep(0.02)
</code></pre>
<ul>
<li>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼šè®¡ç®—å¾„å‘é€Ÿåº¦å‘é‡æ–¹å‘<br>
è®¡ç®—å‘é‡çš„æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯ä¸ç”¨ç®¡å¤§å°æ˜¯å¤šå°‘ï¼Œåªè¦å‘é‡æ–¹å‘æ­£ç¡®å³å¯ã€‚</p>
<p>å› ä¸ºæ— äººæœºå¾ˆå¯èƒ½å¹¶æ²¡æœ‰åœ¨åœ†å‘¨ä¸Šï¼Œæ‰€ä»¥è¦ç»™å®ƒå¾„å‘çš„æŒ‡ä»¤ï¼Œæ¥é™åˆ¶å®ƒåœ¨åœ†å‘¨ä¸Šè¿åŠ¨ï¼Œä¸èƒ½åç¦»å¤ªè¿œã€‚</p>
</li>
<li>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼šè®¡ç®—åˆ‡å‘é€Ÿåº¦å‘é‡æ–¹å‘<br>
åˆ‡å‘é€Ÿåº¦å‘é‡è®¡ç®—æˆ‘æ˜¯å…ˆæ±‚çš„å½“å‰æ–¹ä½è§’ï¼ˆç›¸å¯¹äºåœ†å¿ƒçš„ï¼‰ï¼Œç„¶ååŠ ï¼ˆæˆ–å‡ï¼‰90 åº¦ï¼Œå¾—åˆ°çš„å‘é‡ã€‚</p>
</li>
<li>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼šä¸¤ä¸ªå‘é‡åŠ æƒç›¸åŠ å¹¶å•ä½åŒ–ï¼Œå¾—åˆ°æœ€ç»ˆå•ä½é€Ÿåº¦æ–¹å‘å‘é‡<br>
ä¸¤ä¸ªå‘é‡åŠ æƒå¹³å‡ï¼Œk å€¼æ˜¯éœ€è¦è°ƒèŠ‚çš„ï¼Œè¿™æ ·æ›²çº¿æ‰åœ†æ¶¦ã€‚</p>
</li>
<li>
<p><strong>ç¬¬å››æ­¥</strong>ï¼šå•ä½å‘é‡ä¹˜é€Ÿåº¦ï¼Œå°±æ˜¯æœ€ç»ˆé€Ÿåº¦æŒ‡ä»¤</p>
</li>
</ul>
<h2><span id="5-å¤šæ— äººæœºååŒé›†ç¾¤ç¼–é˜Ÿåˆ†å¸ƒå¼æ§åˆ¶ç®—æ³•">5. å¤šæ— äººæœºååŒé›†ç¾¤ç¼–é˜Ÿï¼ˆåˆ†å¸ƒå¼æ§åˆ¶ç®—æ³•ï¼‰</span></h2>
<hr>
<h3><span id="51-å¤šæ— äººæœºç¼–é˜Ÿæ§åˆ¶ç†è®º">5.1 å¤šæ— äººæœºç¼–é˜Ÿæ§åˆ¶ç†è®º</span></h3>
<p>é›†ç¾¤ç¼–é˜Ÿæ§åˆ¶æœ‰é›†ä¸­å¼å’Œåˆ†å¸ƒå¼ä¸¤ç§ï¼Œé›†ä¸­å¼æ§åˆ¶å—é™äºä¸­å¿ƒè®¡ç®—èµ„æºçš„é™åˆ¶ï¼Œæ— æ³•åšåˆ°å¤§è§„æ¨¡é›†ç¾¤ç¼–é˜Ÿã€‚è€Œåˆ†å¸ƒå¼æ§åˆ¶ï¼Œç†è®ºä¸Šå¯ä»¥åšåˆ°æ— é™è§„æ¨¡çš„é›†ç¾¤ç¼–é˜Ÿã€‚è¿™éƒ¨åˆ†å®ç°çš„é›†ç¾¤æ§åˆ¶ç®—æ³•å°±å±äºä¸€ç§åˆ†å¸ƒå¼çš„æ§åˆ¶ç®—æ³•ã€‚</p>
<p>åˆ†å¸ƒå¼é›†ç¾¤æ§åˆ¶æœ€æ—©æ˜¯ç”± Reynolds åœ¨ 1987 å¹´æå‡ºçš„åˆ†å¸ƒå¼ååŒçš„ä¸‰å®šå¾‹ï¼šé¿ç¢°ã€é€Ÿåº¦ä¸€è‡´ã€ä¸­å¿ƒèšé›†ã€‚åªè¦æ¯ä¸ªæ— äººæœºéƒ½æ»¡è¶³è¿™ä¸‰ä¸ªæ¡ä»¶å°±èƒ½å½¢æˆé›†ç¾¤é£è¡Œçš„æ•ˆæœã€‚åç»­çš„é›†ç¾¤ç ”ç©¶éƒ½æ˜¯åœ¨ä¸‰å®šå¾‹çš„åŸºç¡€ä¸Šè¿›è¡Œçš„ï¼Œæˆ–è€…è¯´åç»­çš„é›†ç¾¤ç®—æ³•éƒ½åŸºæœ¬æ»¡è¶³è¿™ä¸‰ä¸ªå®šå¾‹ï¼Œåªæ˜¯æ»¡è¶³çš„å½¢å¼å„æœ‰åŒºåˆ«ã€‚</p>
<p>è¿™é‡Œå‚è€ƒè®ºæ–‡ä¸­çš„é›†ç¾¤ç®—æ³•ï¼Œåœ¨ AirSim ä¸­å®ç°å¤šæ— äººæœºé›†ç¾¤é£è¡Œçš„æ•ˆæœã€‚è®ºæ–‡ä¸­çš„é›†ç¾¤æ§åˆ¶ç®—æ³•æ˜¯ä¸‰ä¸ªé€Ÿåº¦æŒ‡ä»¤ç›¸åŠ çš„ï¼š</p>
<ul>
<li>é¿ç¢°ï¼š$v_i^{sep}=-\frac{k^{sep}}{||N_i||} \Sigma \frac{r_{ij}}{||r_{ij}||^2}$</li>
<li>ä¸­å¿ƒèšé›†ï¼š$v_i^{coh}=\frac{k^{coh}}{||N_i||} \Sigma r_{ij}$</li>
<li>æ•´ä½“è¿ç§»ï¼ˆé€Ÿåº¦ä¸€è‡´ï¼‰ï¼š$v_i^{mig}=k^{mig} \frac{r_i^{mig}}{||r^{mig}_i||}$</li>
</ul>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>$k$ æ˜¯ç³»æ•°</li>
<li>$N_i = {agents \quad j:j \ne i \wedge ||r_{ij}|| &lt; r^{max}}$
<ul>
<li>$N_i$ è¡¨ç¤ºçš„æ˜¯æ¯ä¸ªæ— äººæœºçš„é‚»å±…æ˜¯å¦‚ä½•é€‰æ‹©çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºæ¯ä¸ªæ— äººæœºæ¥è¯´ï¼Œå…¶å‘¨å›´åŠå¾„èŒƒå›´å†…çš„å…¶ä»–æ— äººæœºéƒ½æ˜¯è‡ªå·±çš„é‚»å±…ã€‚</li>
<li>æ‰€ä»¥ $||N_i||$ è¡¨ç¤ºçš„æ˜¯ç¬¬ $i$ ä¸ªæ— äººæœºå‘¨å›´çš„é‚»å±…ä¸ªæ•°ã€‚</li>
<li>$r_{ij}=p_j-p_i$ è¡¨ç¤ºçš„æ˜¯ä¸¤æ¶æ— äººæœºä¹‹é—´çš„è·ç¦»</li>
<li>$r_i^{mig}=p^{mig}-p_i$ è¡¨ç¤ºçš„æ˜¯ç¬¬ $i$ ä¸ªæ— äººæœºåˆ°ç›®æ ‡ç‚¹çš„è·ç¦»ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™ä¸ªé›†ç¾¤ç®—æ³•æ¯”è¾ƒç®€å•ï¼Œé¿ç¢°å’Œä¸­å¿ƒèšé›†è¿™ä¸¤é¡¹çš„å…¬å¼å¾ˆå¥½ç†è§£ã€‚è®ºæ–‡å°†é€Ÿåº¦ä¸€è‡´é¡¹å˜å½¢ä¸ºäº†æ•´ä½“è¿ç§»ï¼Œå› ä¸ºè®ºæ–‡æƒ³è¦å®ç°çš„ç›®æ ‡æ˜¯è®©æ— äººæœºé›†ç¾¤åˆ°è¾¾å…¨å±€çš„ä¸€ä¸ªå›ºå®šä½ç½®ã€‚</p>
<p>æ·»åŠ é€Ÿåº¦é™å¹…åï¼Œæœ€ç»ˆæ— äººæœºçš„é€Ÿåº¦æŒ‡ä»¤ä¸ºï¼š</p>
<p>$v_i=\frac{\bar{v_i}}{||\bar{v_i}||} min(||\bar{v_i}||, v^{max})$</p>
<p>å…¶ä¸­ï¼š$\bar{v_i}=v_i^{sep} + v_i^{coh} + v_i^{mig}$</p>
<p>å…¶ä¸­çš„å‚æ•°è®¾ç½®å¦‚ä¸‹ï¼š</p>
<ul>
<li>$r^{max}=20m$</li>
<li>$v^{max}=2m/s$</li>
<li>$k^{sep}=7$</li>
<li>$k^{coh}=1$</li>
<li>$k^{mig}=1$</li>
</ul>
<p>æœ€åå½¢æˆçš„é›†ç¾¤æ•ˆæœåº”è¯¥æ˜¯æ¯ä¸¤ä¸ªç›¸é‚»çš„æ— äººæœºéƒ½ä¿æŒåŒæ ·çš„è·ç¦»ç¼–é˜Ÿã€‚</p>
<h3><span id="52-airsim-é›†ç¾¤ç¼–é˜Ÿå®ç°">5.2 AirSim é›†ç¾¤ç¼–é˜Ÿå®ç°</span></h3>
<h4><span id="ä¿®æ”¹-settingsjson-æ–‡ä»¶">ä¿®æ”¹ settings.json æ–‡ä»¶</span></h4>
<p>é¦–å…ˆéœ€è¦ä¿®æ”¹ <code>settings.json</code> æ–‡ä»¶ï¼Œæ·»åŠ å¤šä¸ªæ— äººæœºã€‚åˆå§‹ä½ç½®æ¯ä¸ªæ— äººæœºçš„ä½ç½®éƒ½æ˜¯è‡ªå·±éšä¾¿è®¾ç½®çš„ã€‚</p>
<pre><code class="language-json">&quot;Vehicles&quot;: &#123;
    &quot;UAV1&quot;: &#123;
        &quot;VehicleType&quot;: &quot;SimpleFlight&quot;,
        &quot;X&quot;:0, &quot;Y&quot;:0, &quot;Z&quot;:0,
        &quot;Yaw&quot;: 0
    &#125;,
    &quot;UAV2&quot;: &#123;
      &quot;VehicleType&quot;: &quot;SimpleFlight&quot;,
      &quot;X&quot;: 2, &quot;Y&quot;: 0, &quot;Z&quot;: 0,
      &quot;Yaw&quot;: 0
    &#125;,
    &quot;UAV3&quot;: &#123;
      &quot;VehicleType&quot;: &quot;SimpleFlight&quot;,
      &quot;X&quot;: 4, &quot;Y&quot;: 0, &quot;Z&quot;: 0,
      &quot;Yaw&quot;: 0
    &#125;,
    &quot;UAV4&quot;: &#123;
      &quot;VehicleType&quot;: &quot;SimpleFlight&quot;,
      &quot;X&quot;: 0, &quot;Y&quot;: -3, &quot;Z&quot;: 0,
      &quot;Yaw&quot;: 0
    &#125;,
    &quot;UAV5&quot;: &#123;
      &quot;VehicleType&quot;: &quot;SimpleFlight&quot;,
      &quot;X&quot;: 2, &quot;Y&quot;: -2, &quot;Z&quot;: 0,
      &quot;Yaw&quot;: 0
    &#125;,
    &quot;UAV6&quot;: &#123;
      &quot;VehicleType&quot;: &quot;SimpleFlight&quot;,
      &quot;X&quot;: 4, &quot;Y&quot;: -3, &quot;Z&quot;: 0,
      &quot;Yaw&quot;: 0
    &#125;,
    &quot;UAV7&quot;: &#123;
      &quot;VehicleType&quot;: &quot;SimpleFlight&quot;,
      &quot;X&quot;: 0, &quot;Y&quot;: 3, &quot;Z&quot;: 0,
      &quot;Yaw&quot;: 0
    &#125;,
    &quot;UAV8&quot;: &#123;
      &quot;VehicleType&quot;: &quot;SimpleFlight&quot;,
      &quot;X&quot;: 2, &quot;Y&quot;: 2, &quot;Z&quot;: 0,
      &quot;Yaw&quot;: 0
    &#125;,
    &quot;UAV9&quot;: &#123;
      &quot;VehicleType&quot;: &quot;SimpleFlight&quot;,
      &quot;X&quot;: 4, &quot;Y&quot;: 3, &quot;Z&quot;: 0,
      &quot;Yaw&quot;: 0
    &#125;
&#125;
</code></pre>
<h4><span id="ç¼–é˜Ÿç®—æ³•ä»£ç ">ç¼–é˜Ÿç®—æ³•ä»£ç </span></h4>
<pre><code class="language-python">import airsim
import time
import numpy as np

origin_x = [0, 2, 4, 0, 2, 4, 0, 2, 4]       # æ— äººæœºåˆå§‹ä½ç½®
origin_y = [0, 0, 0, -3, -2, -3, 3, 2, 3]

def get_UAV_pos(client, vehicle_name=&quot;SimpleFlight&quot;):
    global origin_x
    global origin_y
    state = client.simGetGroundTruthKinematics(vehicle_name=vehicle_name)
    x = state.position.x_val
    y = state.position.y_val
    i = int(vehicle_name[3])
    x += origin_x[i - 1]
    y += origin_y[i - 1]
    pos = np.array([[x], [y]])
    return pos


client = airsim.MultirotorClient()  # connect to the AirSim simulator
for i in range(9):
    name = &quot;UAV&quot;+str(i+1)
    client.enableApiControl(True, name)     # è·å–æ§åˆ¶æƒ
    client.armDisarm(True, name)            # è§£é”ï¼ˆèºæ—‹æ¡¨å¼€å§‹è½¬åŠ¨ï¼‰
    if i != 8:                              # èµ·é£
        client.takeoffAsync(vehicle_name=name)
    else:
        client.takeoffAsync(vehicle_name=name).join()

for i in range(9):                          # å…¨éƒ¨éƒ½é£åˆ°åŒä¸€é«˜åº¦å±‚
    name = &quot;UAV&quot; + str(i + 1)
    if i != 8:
        client.moveToZAsync(-3, 1, vehicle_name=name)
    else:
        client.moveToZAsync(-3, 1, vehicle_name=name).join()


# å‚æ•°è®¾ç½®
v_max = 2     # æ— äººæœºæœ€å¤§é£è¡Œé€Ÿåº¦
r_max = 20    # é‚»å±…é€‰æ‹©çš„åŠå¾„
k_sep = 7     # æ§åˆ¶ç®—æ³•ç³»æ•°
k_coh = 1
k_mig = 1
pos_mig = np.array([[25], [0]])   # ç›®æ ‡ä½ç½®
v_cmd = np.zeros([2, 9])

for t in range(500):
    for i in range(9):   # è®¡ç®—æ¯ä¸ªæ— äººæœºçš„é€Ÿåº¦æŒ‡ä»¤
        name_i = &quot;UAV&quot;+str(i+1)
        pos_i = get_UAV_pos(client, vehicle_name=name_i)
        r_mig = pos_mig - pos_i
        v_mig = k_mig * r_mig / np.linalg.norm(r_mig)
        v_sep = np.zeros([2, 1])
        v_coh = np.zeros([2, 1])
        N_i = 0
        for j in range(9):
            if j != i:
                name_j = &quot;UAV&quot;+str(j+1)
                pos_j = get_UAV_pos(client, vehicle_name=name_j)
                if np.linalg.norm(pos_j - pos_i) &lt; r_max:
                    N_i += 1
                    r_ij = pos_j - pos_i
                    v_sep += -k_sep * r_ij / np.linalg.norm(r_ij)
                    v_coh += k_coh * r_ij
        v_sep = v_sep / N_i
        v_coh = v_coh / N_i
        v_cmd[:, i:i+1] = v_sep + v_coh + v_mig

    for i in range(9):   # æ¯ä¸ªæ— äººæœºçš„é€Ÿåº¦æŒ‡ä»¤æ‰§è¡Œ
        name_i = &quot;UAV&quot;+str(i+1)
        client.moveByVelocityZAsync(v_cmd[0, i], v_cmd[1, i], -3, 0.1, vehicle_name=name_i)

# å¾ªç¯ç»“æŸ
client.simPause(False)
for i in range(9):
    name = &quot;UAV&quot;+str(i+1)
    if i != 8:                                              # é™è½
        client.landAsync(vehicle_name=name)
    else:
        client.landAsync(vehicle_name=name).join()
for i in range(9):
    name = &quot;UAV&quot; + str(i + 1)
    client.armDisarm(False, vehicle_name=name)              # ä¸Šé”
    client.enableApiControl(False, vehicle_name=name)       # é‡Šæ”¾æ§åˆ¶æƒ
</code></pre>
<h2><span id="6-çŠ¶æ€è¯»å–-api-amp-å¤šæ— äººæœºä½ç½®è¯»å–å‡½æ•°å°è£…">6. çŠ¶æ€è¯»å– API &amp; å¤šæ— äººæœºä½ç½®è¯»å–å‡½æ•°å°è£…</span></h2>
<hr>
<h3><span id="61-æ— äººæœºçœŸå€¼çŠ¶æ€è¯»å–-api">6.1 æ— äººæœºçœŸå€¼çŠ¶æ€è¯»å– API</span></h3>
<p>æ— äººæœºçš„çœŸå€¼çŠ¶æ€è¯»å–æ¥å£å¯ä»¥å¾—åˆ°æ— äººæœºçš„çœŸå€¼çŠ¶æ€ï¼ˆæ— è¯¯å·®ï¼‰ï¼Œæ­¤æ¥å£åŒæ ·é€‚ç”¨äºæ— äººè½¦ï¼Œå±äº vehicle ç±»çš„é€šç”¨ APIã€‚æ¥å£çš„è°ƒç”¨æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">kinematic_state_groundtruth = client.simGetGroundTruthKinematics(vehicle_name='')
</code></pre>
<p>å…¶ä¸­è¿”å›å€¼ <code>kinematic_state_groundtrutth</code> åŒ…å« 6 ä¸ªå±æ€§ï¼š</p>
<pre><code class="language-python"># state_groundtruth çš„ 6 ä¸ªå±æ€§
kinematic_state_groundtruth.position            # ä½ç½®ä¿¡æ¯
kinematic_state_groundtruth.linear_velocity     # é€Ÿåº¦ä¿¡æ¯
kinematic_state_groundtruth.linear_acceleration # åŠ é€Ÿåº¦ä¿¡æ¯
kinematic_state_groundtruth.orientation         # å§¿æ€ä¿¡æ¯
kinematic_state_groundtruth.angular_velocity    # å§¿æ€è§’é€Ÿåº¦ä¿¡æ¯
kinematic_state_groundtruth.angular_acceleration  # å§¿æ€è§’åŠ é€Ÿåº¦ä¿¡æ¯
</code></pre>
<p>ä»¥ä¸Š 6 ä¸ªå±æ€§ä¸­ï¼Œé™¤äº† <code>orientation</code> å…¶ä»–å‡ ä¸ªéƒ½åŒ…å«äº† <code>x_val</code>ã€<code>y_val</code> å’Œ <code>z_val</code> ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«ä»£è¡¨ x,y,z 3 ä¸ªæ–¹å‘çš„å€¼ã€‚ä¾‹å¦‚ä½ç½®çœŸå€¼çš„è¯»å–å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python"># æ— äººæœºå…¨å±€ä½ç½®åæ ‡çœŸå€¼
x = kinematic_state_groundtruth.position.x_val  # å…¨å±€åæ ‡ç³»ä¸‹ï¼Œx è½´æ–¹å‘çš„åæ ‡
y = kinematic_state_groundtruth.position.y_val  # å…¨å±€åæ ‡ç³»ä¸‹ï¼Œy è½´æ–¹å‘çš„åæ ‡
z = kinematic_state_groundtruth.position.z_val  # å…¨å±€åæ ‡ç³»ä¸‹ï¼Œz è½´æ–¹å‘çš„åæ ‡
</code></pre>
<p>åŒç†ï¼Œé€Ÿåº¦ã€åŠ é€Ÿåº¦ã€å§¿æ€è§’é€Ÿåº¦ã€å§¿æ€è§’åŠ é€Ÿåº¦çœŸå€¼çš„è¯»å–å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python"># æ— äººæœºå…¨å±€é€Ÿåº¦çœŸå€¼
vx = kinematic_state_groundtruth.linear_velocity.x_val    # æ— äººæœº x è½´æ–¹å‘ï¼ˆæ­£åŒ—ï¼‰
vy = kinematic_state_groundtruth.linear_velocity.y_val    # æ— äººæœº y è½´æ–¹å‘ï¼ˆæ­£ä¸œï¼‰
vz = kinematic_state_groundtruth.linear_velocity.z_val    # æ— äººæœº z è½´æ–¹å‘ï¼ˆå‚ç›´ï¼‰

# æ— äººæœºå…¨å±€åŠ é€Ÿåº¦çœŸå€¼
ax = kinematic_state_groundtruth.linear_acceleration.x_val
ay = kinematic_state_groundtruth.linear_acceleration.y_val
az = kinematic_state_groundtruth.linear_acceleration.z_val

# æœºä½“è§’é€Ÿåº¦
kinematic_state_groundtruth.angular_velocity.x_val    # æœºä½“ä¿¯ä»°è§’é€Ÿç‡
kinematic_state_groundtruth.angular_velocity.y_val    # æœºä½“ç¿»æ»šè§’é€Ÿç‡
kinematic_state_groundtruth.angular_velocity.z_val    # æœºä½“åèˆªè§’é€Ÿç‡

# æœºä½“è§’åŠ é€Ÿåº¦
kinematic_state_groundtruth.angular_acceleration.x_val
kinematic_state_groundtruth.angular_acceleration.y_val
kinematic_state_groundtruth.angular_acceleration.z_val
</code></pre>
<p>è€Œå¯¹äºå§¿æ€çš„è¯»å–ï¼Œå§¿æ€ä¿¡æ¯æ˜¯ç”¨å››å…ƒæ•°è¡¨ç¤ºçš„ï¼Œè€Œ AirSim åŒæ—¶ä¹Ÿæä¾›äº†å››å…ƒæ•°è½¬æ¢ä¸ºæ¬§æ‹‰è§’çš„æ¥å£ï¼š</p>
<pre><code class="language-python"># æ— äººæœºå§¿æ€çœŸå€¼çš„å››å…ƒæ•°è¡¨ç¤º
kinematic_state_groundtruth.orientation.x_val
kinematic_state_groundtruth.orientation.y_val
kinematic_state_groundtruth.orientation.z_val
kinematic_state_groundtruth.orientation.w_val

# å››å…ƒæ•°è½¬æ¢ä¸ºæ¬§æ‹‰è§’ï¼Œå•ä½ rad
(pitch, roll, yaw) = airsim.to_eularian_angles(kinematic_state_groundtruth.orientation)
</code></pre>
<h3><span id="62-æ— äººæœºçŠ¶æ€ä¼°è®¡å€¼è¯»å–-api">6.2 æ— äººæœºçŠ¶æ€ä¼°è®¡å€¼è¯»å– API</span></h3>
<p>åœ¨å®é™…çš„æ— äººæœºä¸­ï¼Œæ— æ³•è·å–æ— äººæœºçš„çŠ¶æ€çœŸå€¼ï¼ŒçŠ¶æ€çš„è¯»å–æ˜¯æ— äººæœºä¸Šä¼ æ„Ÿå™¨èåˆå¾—åˆ°çš„ä¼°è®¡å€¼ã€‚AirSim APIs è¿˜æä¾›äº†è·å–æ— äººæœºçŠ¶æ€ï¼ˆä¼°è®¡å€¼ï¼‰çš„åŠŸèƒ½æ¥å£ï¼Œå…¶è°ƒç”¨æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">state_multirotor = client.getMultirotorState(vehicle_name='')
</code></pre>
<p>è¿™é‡Œçš„æ— äººæœºçŠ¶æ€ <code>state_multirotor</code> åŒ…å«ï¼šæ—¶é—´æˆ³ã€è¿åŠ¨çŠ¶æ€ä¿¡æ¯ï¼ˆä¼°è®¡å€¼ï¼‰ã€ç¢°æ’ä¿¡æ¯ã€GPS ç»çº¬åº¦ä¿¡æ¯ã€é¥æ§å™¨ä¿¡æ¯ã€é™è½ä¿¡æ¯ç­‰ã€‚è¯»å–æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">state_multirotor.collision            # ç¢°æ’ä¿¡æ¯
state_multirotor.kinematics_estimated # è¿åŠ¨ä¿¡æ¯
state_multirotor.gps_location         # GPS ç»çº¬åº¦ä¿¡æ¯
state_multirotor.timestamp             # æ—¶é—´æˆ³
state_multirotor.landed_state         # é™è½ä¿¡æ¯
state_multirotor.rc_data              # é¥æ§å™¨ä¿¡æ¯
</code></pre>
<p>å…¶ä¸­çš„é™è½ä¿¡æ¯ <code>state_multirotor.landed_state</code> æ˜¯æ•´æ•°ç±»å‹ï¼Œå…¶å€¼ä¸º 0 è¡¨ç¤ºåœ¨åœ°ä¸Šï¼Œå€¼ä¸º 1 è¡¨ç¤ºåœ¨ç©ºä¸­ã€‚å…¶ä¸­çš„æ—¶é—´æˆ³ <code>state_multirotor.timestamp</code> æ˜¯ä»¿çœŸå¼€å§‹åçš„æ—¶é—´ï¼Œå•ä½æ˜¯<strong>çº³ç§’</strong>ã€‚</p>
<p>æ— äººæœºçŠ¶æ€ä¸­çš„è¿åŠ¨ä¿¡æ¯ <code>state_multirotor.kinematics_estimated</code> æ˜¯ç”±å¤šä¸ªä¼ æ„Ÿå™¨æµ‹é‡å€¼èåˆå¾—åˆ°çš„ï¼ŒåŒ…å« 6 ç§è¿åŠ¨ä¿¡æ¯ï¼Œè¯»å–æ–¹å¼ç›¸åŒï¼š</p>
<pre><code class="language-python"># æ— äººæœºè¿åŠ¨ä¿¡æ¯çš„ä¼°è®¡å€¼æœ‰ 6 ä¸ªå±æ€§
state_multirotor.kinematic_estimated.position             # ä½ç½®ä¿¡æ¯ä¼°è®¡å€¼
state_multirotor.kinematic_estimated.linear_velocity      # é€Ÿåº¦ä¿¡æ¯ä¼°è®¡å€¼
state_multirotor.kinematic_estimated.linear_acceleration  # åŠ é€Ÿåº¦ä¿¡æ¯ä¼°è®¡å€¼
state_multirotor.kinematic_estimated.orientation          # å§¿æ€ä¿¡æ¯ä¼°è®¡å€¼
state_multirotor.kinematic_estimated.angular_velocity     # å§¿æ€è§’é€Ÿç‡ä¿¡æ¯ä¼°è®¡å€¼
state_multirotor.kinematic_estimated.angular_acceleration # å§¿æ€è§’åŠ é€Ÿåº¦ä¿¡æ¯ä¼°è®¡å€¼
</code></pre>
<p>ä½†æ˜¯é—æ†¾çš„æ˜¯ï¼Œ<code>SimpleFlight</code> ä¸æ”¯æŒæ¨¡æ‹Ÿä¼ æ„Ÿå™¨ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨çš„æ˜¯ <code>SimpleFlight</code>ï¼Œåˆ™ä½¿ç”¨ <code>getMultirotorState()</code> å¾—åˆ°çš„è¿åŠ¨çŠ¶æ€ä¸ä½¿ç”¨ <code>simGetGroundTruthKinematics()</code> å¾—åˆ°çš„è¿åŠ¨çŠ¶æ€çœŸå€¼æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚å¦‚æœä½¿ç”¨ç¡¬ä»¶åœ¨ç¯ä»¿çœŸï¼ˆå¦‚ PX4 ç­‰ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>getMultirotorState()</code> è·å¾—æ— äººæœºçš„ä¼°è®¡çŠ¶æ€ä¿¡æ¯ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬æš‚æ—¶åªä»‹ç»æ—¶é—´æˆ³ã€é™è½ä¿¡æ¯å’Œè¿åŠ¨ä¿¡æ¯ï¼Œå¯¹äºç¢°æ’ä¿¡æ¯å’Œ GPS ç»çº¬åº¦ä¿¡æ¯åœ¨åé¢æœ‰å…·ä½“çš„è®²è§£ã€‚</p>
<p>AirSim APIs è¿˜æä¾›äº†è·å–ç”µæœºçŠ¶æ€çš„åŠŸèƒ½æ¥å£ï¼Œè°ƒç”¨æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">state_rotor = client.getRotorStates(vehicle_nane='')
</code></pre>
<p>å‡½æ•°çš„è¿”å›å€¼ <code>state_rotor</code> åŒ…å«æ—¶é—´æˆ³å’Œæ¯ä¸ªèºæ—‹æ¡¨çš„è½¬é€Ÿã€æ‹‰åŠ›ã€åŠ›çŸ©ä¿¡æ¯ã€‚ä½¿ç”¨ <code>print()</code> å°†å…¶æ‰“å°å‡ºæ¥ï¼ˆæ— äººæœºæ‚¬åœçŠ¶æ€ä¸‹ï¼‰ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="language-python">&lt;RotorStates&gt; &#123;   'rotors': [   &#123;   'speed': 516.8734130859375,
                       'thrust': 2.4884119033813477,
                       'torque_scaler': -0.03308132290840149&#125;,
                   &#123;   'speed': 516.8734130859375,
                       'thrust': 2.4884119033813477,
                       'torque_scaler': -0.03308132290840149&#125;,
                   &#123;   'speed': 516.8734130859375,
                       'thrust': 2.4884119033813477,
                       'torque_scaler': 0.03308132290840149&#125;,
                   &#123;   'speed': 516.8734130859375,
                       'thrust': 2.4884119033813477,
                       'torque_scaler': 0.03308132290840149&#125;],
     'timestamp': 1632472243084013312&#125;
</code></pre>
<p>å¦‚æœæƒ³è¦å•ç‹¬å¾—åˆ°ç¬¬ 0 ä¸ªèºæ—‹æ¡¨çš„è½¬é€Ÿä¿¡æ¯ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-python">state_rotors = client.getRotorStates(vehicle_name=&quot;&quot;)
print(state_rotors.rotors[0]['speed'])
</code></pre>
<p>è¿™æ ·å¯ä»¥ç›´æ¥æ‰“å°å‡ºç”µæœºçš„è½¬é€Ÿã€‚ä½¿ç”¨ç”µæœºè½¬é€Ÿæ§åˆ¶å¯ä»¥å®ç°å¯¹æ— äººæœºè¿åŠ¨æ§åˆ¶ç²¾åº¦è¾ƒé«˜çš„åº”ç”¨ï¼Œå¦‚é«˜ç²¾åº¦è½¨è¿¹è·Ÿè¸ªã€‚</p>
<h3><span id="63-ä½ç½®è¯»å–å‡½æ•°å°è£…é‡ç‚¹">6.3 ä½ç½®è¯»å–å‡½æ•°å°è£…ï¼ˆé‡ç‚¹ï¼‰</span></h3>
<p><strong>æ— äººæœºä½ç½®è¯»å–æ—¶ä½¿ç”¨çš„æ˜¯å…¨å±€åæ ‡ç³»ï¼Œè¿™é‡Œçš„å…¨å±€åæ ‡ç³»å®šä¹‰æ˜¯åŒ—ä¸œåœ°ï¼Œå…¨å±€åæ ‡ç³»çš„åŸç‚¹æ˜¯æ— äººæœºçš„åˆå§‹ä½ç½®ã€‚</strong></p>
<p>ä¹Ÿå°±æ˜¯è¯´å½“æœ‰å¤šä¸ªæ— äººæœºæ—¶ï¼Œè€Œä¸”æ¯ä¸ªæ— äººæœºçš„åˆå§‹ä½ç½®ä¸åŒæ—¶ï¼Œæ­¤æ¥å£è¯»å–åˆ°çš„ä¸åŒçš„æ— äººæœºçš„çŠ¶æ€æ˜¯ä»¥å…¶è¯»çš„æ— äººæœºçš„åˆå§‹ä½ç½®ä¸ºåŸç‚¹çš„ï¼Œæ‰€ä»¥åœ¨è¯»å–çš„æ—¶å€™éœ€è¦åŠ ä¸Šå…¶åˆå§‹ä½ç½®çš„è¡¥å¿ã€‚</p>
<p>åŸºäºæ­¤å¯ä»¥å†™å‡ºå¦‚ä¸‹ä½ç½®è¯»å–çš„å‡½æ•°å°è£…ï¼š</p>
<pre><code class="language-python">orig_pos = np.array([[0., 0., 0.,], 
                     [3., 0., 0.]])
def get_uav_pos(client, name):
    uav_state = client.getMultirotorState(vehicle_name=name).kinematics_estimated
    num = int(name[-1])
    pos = np.array([[uav_state.position.x_val + orig_pos[num, 0]], 
                    [uav_state.position.x_val + orig_pos[num, 1]], 
                    [uav_state.position.x_val + orig_pos[num, 2]]])
    return pos
</code></pre>
<p>å…¶ä¸­ <code>orig_pos</code> æ˜¯æ¯ä¸ªæ— äººæœºçš„åˆå§‹ä½ç½®ï¼Œä¸Šé¢çš„ä»£ç ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ— äººæœºï¼Œæ— äººæœº 0 çš„åˆå§‹ä½ç½®æ˜¯ [0, 0, 0]ï¼Œæ— äººæœº 1 çš„åˆå§‹ä½ç½®æ˜¯ [3, 0, 0]ã€‚ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æ·»åŠ è¡¥å¿åï¼Œå°±å¯ä»¥å°†æ¯ä¸ªæ— äººæœºçš„å…¨å±€åæ ‡ç³»ç»Ÿä¸€äº†ã€‚</p>
<h2><span id="7-èˆªè·¯ç‚¹é£è¡Œ-api-amp-å¤šæ— äººæœºä½ç½®æ§åˆ¶å‡½æ•°å°è£…">7. èˆªè·¯ç‚¹é£è¡Œ API &amp; å¤šæ— äººæœºä½ç½®æ§åˆ¶å‡½æ•°å°è£…</span></h2>
<hr>
<p>AirSim æä¾›çš„è½¨è¿¹è·Ÿè¸ª API æ˜¯åŸºäºä½ç½®æ§åˆ¶çš„ï¼Œæ‰€ä»¥ä¸¥æ ¼æ„ä¹‰ä¸Šå¹¶ä¸èƒ½ç®—æ˜¯è½¨è¿¹è·Ÿè¸ªï¼Œè€Œåº”è¯¥ç§°ä¹‹ä¸ºè¿ç»­èˆªè·¯ç‚¹é£è¡Œã€‚æ— äººæœºä¼šä¾æ¬¡é£è¿‡å¤šä¸ªèˆªè·¯ç‚¹ï¼Œå½¢æˆç‰¹å®šçš„é£è¡Œè½¨è¿¹ï¼Œå…¶è°ƒç”¨æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python"># èˆªè·¯ç‚¹è½¨è¿¹é£è¡Œæ§åˆ¶
client.moveOnPathAsync(path, velocity, 
                    drivetrain = DrivetrainType.MaxDegreeOfFreedom, 
                    yaw_mode = YawMode(), 
                    lookahead = -1, adaptive_lookahead = 1, 
                    vehicle_name = '')
</code></pre>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>path(list[Vector3r]):å¤šä¸ªèˆªè·¯ç‚¹çš„ 3 ç»´åæ ‡</li>
<li>velocity(float)ï¼šæ— äººæœºçš„é£è¡Œé€Ÿåº¦å¤§å°ï¼›</li>
<li>lookaheadï¼Œadaptive_lookaheadï¼šè®¾ç½®è·¯å¾„è·Ÿè¸ªç®—æ³•çš„å‚æ•°</li>
</ul>
<p>å‚æ•° path åŒ…å«äº†å¤šä¸ªèˆªè·¯ç‚¹çš„å…¨å±€ä½ç½®åæ ‡ï¼Œä¹Ÿå°±æ˜¯è¯´æ— äººæœºè¦é£è¿‡ path ä¸­åŒ…å«çš„æ¯ä¸€ä¸ªåæ ‡ç‚¹ï¼ˆä¹Ÿå°±æ˜¯èˆªè·¯ç‚¹ï¼‰ã€‚å°† path ä¸­çš„èˆªè·¯ç‚¹ä¾æ¬¡è¿æ¥èµ·æ¥ï¼Œå°±ä¼šç»„æˆä¸€æ¡è·¯å¾„ï¼Œæ— äººæœºä¾æ¬¡é£è¿‡èˆªè·¯ç‚¹ï¼Œå°±åƒæ˜¯æ²¿ç€ç‰¹å®šè·¯å¾„é£è¡Œä¸€æ ·ï¼Œå½¢æˆè·¯å¾„è·Ÿè¸ªçš„æ•ˆæœã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å…¨å±€åæ ‡ç³»çš„åŸç‚¹æ˜¯æ— äººæœºçš„åˆå§‹ä½ç½®ï¼Œæ‰€ä»¥å½“æœ‰å¤šæ¶æ— äººæœºåŒæ—¶ä»¿çœŸçš„æ—¶å€™ï¼Œæ¯æ¶æ— äººæœºçš„åŸç‚¹æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥å½“ä½¿ç”¨ç»Ÿä¸€çš„å…¨å±€åæ ‡ç³»çš„æ—¶å€™ï¼Œéœ€è¦å¯¹ä¸åŒçš„æ— äººæœºæ·»åŠ ä½ç½®è¡¥å¿ã€‚</p>
<p><code>moveOnPathAsync</code> ä¸­ä½¿ç”¨çš„ç®—æ³•æ˜¯ <strong>Carrot Chasing Algorithm</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„è·¯å¾„è·Ÿè¸ªç®—æ³•ï¼Œå…¶ä¸­éœ€è¦è®¾ç½® <code>lookahead</code> å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„æ„ä¹‰æ˜¯è®¾ç½®åœ¨è·¯å¾„ä¸Šå‘å‰çœ‹çš„è·ç¦»ã€‚<code>lookahead</code> è®¾ç½®çš„è¶Šå¤§ï¼Œåœ¨è·¯å¾„æ‹å¼¯çš„æ—¶å€™ï¼Œæ— äººæœºå°±è¶Šæå‰è½¬å¼¯ï¼›å¦‚æœ <code>lookahead</code> å‚æ•°è®¾ç½®çš„è¿‡å°ï¼Œåˆ™å¯èƒ½å‡ºç°è¶…è°ƒï¼Œæ— äººæœºä¼šé£è·ƒèˆªè·¯ç‚¹ï¼Œç„¶åæ‰æ‹å¼¯ã€‚</p>
<p>ä»»ä½•æ—¶å€™ï¼Œ<code>lookahead</code> å€¼çš„è®¾ç½®è¦å¤§äºä½ç½®æ§åˆ¶å…è®¸çš„è¯¯å·®ï¼Œå¹¶ä¸”å°äºæ•´ä¸ªè·¯å¾„çš„æ€»é•¿åº¦ã€‚å¦‚æœ <code>lookahead</code> å€¼å°äºä½ç½®æ§åˆ¶å…è®¸çš„è¯¯å·®ï¼Œåˆ™æ— äººæœºä¼šè®¤ä¸ºå·²ç»åˆ°è¾¾äº†ç¬¬ä¸€ä¸ªç›®æ ‡ç‚¹ï¼Œæœ€ç»ˆæ•ˆæœæ˜¯æ— äººæœºæ‚¬åœåœ¨åŸåœ°ã€‚å¦‚æœ <code>lookahead</code> å€¼å¤§äºè½¨è¿¹çš„æ€»é•¿åº¦ï¼Œåˆ™æ— äººæœºä¼šè®¤ä¸ºå·²ç»è¾¾åˆ°äº†æœ€åä¸€ä¸ªèˆªè·¯ç‚¹ï¼Œæœ€ç»ˆæ•ˆæœè¿˜æ˜¯æ— äººæœºæ‚¬åœåœ¨åŸåœ°ã€‚</p>
<p>å½“ <code>lookahead</code> å‚æ•°å°äº 0 æ—¶ï¼Œ<code>adaptive_lookahead</code> è®¾ç½®ä¸ºå¤§äº 0 çš„æ•°å€¼ï¼Œè¿™æ ·å¯ä»¥è®©ç®—æ³•æ ¹æ®å½“å‰çš„æ— äººæœºé£è¡Œé€Ÿåº¦è‡ªåŠ¨è®¾ç½® <code>lookahead</code> çš„å€¼ï¼Œé€šå¸¸æŒ‰ç…§é»˜è®¤è®¾ç½®ï¼ˆ<code>lookahead=1</code>ï¼Œ<code>adaptive_lookahead=-1</code>ï¼‰å°±å¯ä»¥è¾¾åˆ°æ¯”è¾ƒå¥½çš„æ•ˆæœã€‚</p>
<p>å¦‚æœèˆªè·¯ç‚¹ç»„æˆçš„è½¨è¿¹æ˜¯ä¸€æ¡ç›´çº¿ï¼Œä¸å­˜åœ¨è½¬å¼¯çš„æƒ…å†µï¼Œé‚£ä¹ˆ<code>lookahead</code> å€¼çš„å¤§å°å¯¹æœ€ç»ˆè½¨è¿¹çš„å½±å“å°†å‡å°å¾ˆå¤šï¼Œæ­¤æ—¶ <code>lookahead</code> çš„å€¼åªè¦å°äºè½¨è¿¹çš„æ€»é•¿åº¦å³å¯ã€‚ä¾‹å¦‚ <code>moveToPositionAsync()</code> æ¥å£å‡½æ•°å†…å®¹å°±æ˜¯è°ƒç”¨çš„ <code>moveOnPathAsync</code> æ¥å£ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸€ä¸ªèˆªè·¯ç‚¹çš„è½¨è¿¹ï¼Œæ­¤æ—¶è½¨è¿¹å°±æ˜¯ä¸€æ¡ç›´çº¿ï¼Œåªè¦ <code>lookahead</code> å€¼å°äºå½“å‰åˆ°å”¯ä¸€èˆªè·¯ç‚¹çš„è·ç¦»ï¼Œæœ€ç»ˆçš„é£è¡Œè½¨è¿¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<h2><span id="8-å›¾åƒ-apis">8. å›¾åƒ APIs</span></h2>
<hr>
<h3><span id="81-æ‹æ‘„å›¾åƒå‰çš„åŸºæœ¬çŸ¥è¯†">8.1 æ‹æ‘„å›¾åƒå‰çš„åŸºæœ¬çŸ¥è¯†</span></h3>
<h4><span id="å›¾åƒä½ç½®">å›¾åƒä½ç½®</span></h4>
<p>AirSim å¹³å°ä¸­çš„æ— äººæœºå’Œæ— äººè½¦éƒ½é»˜è®¤æ”¾æœ‰ 5 ä¸ªç›¸æœºï¼Œåªæ˜¯ä½ç½®ä¸åŒï¼Œè¿™é‡Œä¸»è¦ä»‹ç»æ— äººæœºä¸Šçš„ç›¸æœºã€‚ä¸‹è¡¨åˆ—å‡ºçš„æ˜¯ç›¸æœºçš„ä½ç½®å’Œå‘½åã€‚æ—§ç‰ˆæœ¬çš„ AirSim å¯¹ç›¸æœºçš„å‘½åæ˜¯ä½¿ç”¨çš„æ•°å­—ï¼Œç›®å‰ AirSim å…¼å®¹æ—§ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä½¿ç”¨æ•°å­—ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<table>
<thead>
<tr>
<th>ç›¸æœºä½ç½®</th>
<th>ID</th>
<th>æ—§ç‰ˆæœ¬ ID</th>
</tr>
</thead>
<tbody>
<tr>
<td>å‰å‘ä¸­é—´</td>
<td><code>front_center</code></td>
<td><code>0</code></td>
</tr>
<tr>
<td>å‰å‘å³è¾¹</td>
<td><code>front_right</code></td>
<td><code>1</code></td>
</tr>
<tr>
<td>å‰å‘å·¦è¾¹</td>
<td><code>front_left</code></td>
<td><code>2</code></td>
</tr>
<tr>
<td>åº•éƒ¨ä¸­é—´</td>
<td><code>bottom_center</code></td>
<td><code>3</code></td>
</tr>
<tr>
<td>åå‘ä¸­é—´</td>
<td><code>back_center</code></td>
<td><code>4</code></td>
</tr>
</tbody>
</table>
<h4><span id="å›¾åƒç§ç±»">å›¾åƒç§ç±»</span></h4>
<p>AirSim ä¸­é»˜è®¤å¯ä»¥è·å¾— 8 ç§ä¸åŒç±»å‹çš„å›¾ç‰‡ï¼Œä¸‹è¡¨æ€»ç»“äº† 10 ç§ç±»å‹å›¾ç‰‡çš„åç§°ã€è§£é‡Šå’Œè°ƒç”¨æ–¹å¼ã€‚</p>
<table>
<thead>
<tr>
<th>å›¾åƒç±»å‹</th>
<th>è§£é‡Š</th>
<th>è°ƒç”¨æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>Scene</td>
<td>å½©è‰²å›¾</td>
<td>airsim.ImageType.Scene</td>
</tr>
<tr>
<td>DepthPlanar</td>
<td>æ·±åº¦å›¾ï¼Œåƒç´ å€¼ä»£è¡¨åˆ°ç›¸å¹³é¢çš„è·ç¦»</td>
<td>airsim.ImageType.DepthPlanar</td>
</tr>
<tr>
<td>DepthPerspective</td>
<td>æ·±åº¦å›¾ï¼Œåƒç´ å€¼ä»£è¡¨é€è§†æŠ•å½±ä¸‹åˆ°ç›¸å¹³é¢çš„è·ç¦»</td>
<td>airsim.ImageType.DepthPerspective</td>
</tr>
<tr>
<td>DepthVis</td>
<td>æ·±åº¦å›¾ï¼Œä¸ºäº†æ›´å¥½çš„å±•ç¤ºè·ç¦»çš„è¿œè¿‘ï¼Œ100 ç±³å¯¹åº”ç™½è‰²ï¼Œ0 ç±³å¯¹åº”é»‘è‰²</td>
<td>airsim.ImageType.DepthVis</td>
</tr>
<tr>
<td>DisparityNormalized</td>
<td>æ·±åº¦è§†å·®å›¾ï¼Œæ¯ä¸ªåƒç´ å€¼æ˜¯æµ®ç‚¹å‹</td>
<td>airsim.ImageType.DisparityNormalized</td>
</tr>
<tr>
<td>Segmentation</td>
<td>åˆ†å‰²å›¾ï¼Œä¸åŒ ID å·çš„ç‰©ä½“ç”¨ä¸åŒçš„é¢œè‰²è¡¨ç¤º</td>
<td>airsim.ImageType.Segmentation</td>
</tr>
<tr>
<td>SurfaceNormals</td>
<td>è¡¨é¢æ³•çº¿ï¼ŒåŒ…å«äº†æ¯”è¾ƒä¸°å¯Œçš„ç»†èŠ‚ä¿¡æ¯</td>
<td>airsim.ImageType.SurfaceNormals</td>
</tr>
<tr>
<td>Infrared</td>
<td>çº¢å¤–å›¾ï¼Œä¸åˆ†å‰²å›¾ç±»ä¼¼ï¼ŒçŸ¥è¯†é¢œè‰²å˜ä¸º ID å·</td>
<td>airsim.ImageType.Infrared</td>
</tr>
</tbody>
</table>
<h4><span id="å›¾åƒæ•°æ®çš„æ ¼å¼">å›¾åƒæ•°æ®çš„æ ¼å¼</span></h4>
<p>AirSim ä¸­è·å¾—çš„å›¾åƒæœ‰ 3 ç§æ ¼å¼ï¼šPNG æ ¼å¼ã€Array æ ¼å¼ã€æµ®ç‚¹å‹æ ¼å¼ã€‚é€šè¿‡åœ¨ç¨‹åºä¸­è®¾ç½®ä¸åŒçš„å‚æ•°å³å¯å¾—åˆ°ä¸åŒæ ¼å¼çš„å›¾åƒã€‚</p>
<p>PNG æ ¼å¼çš„å›¾ç‰‡æ˜¯ä¸€ç§æ— æŸå‹ç¼©çš„å›¾ç‰‡æ ¼å¼ï¼Œç”±äºå…¶å…·æœ‰è¿ç»­è¯»å‡ºå’Œå†™å…¥çš„ç‰¹æ€§ï¼Œæ‰€ä»¥éå¸¸é€‚åˆäºç½‘ç»œä¼ æ’­ã€‚å…¶æ–‡ä»¶ç»“æ„ä¸­åŒ…æ‹¬ï¼šæ–‡ä»¶ç½²ååŸŸå’Œæ•°æ®å—ï¼ˆå…³é”®æ•°æ®å—ã€è¾…åŠ©æ•°æ®å—ï¼‰ã€‚æ–‡ä»¶ç½²ååŸŸçš„ 8 ä¸ªå›ºå®šå­—èŠ‚ç”¨æ¥è¯†åˆ«è¯¥æ–‡ä»¶æ˜¯ä¸æ˜¯ PNG æ ¼å¼çš„æ–‡ä»¶ã€‚æ•°æ®å—ä¸­åŒ…å«äº†å›¾åƒçš„å¤§å°ã€è‰²æ·±ã€é¢œè‰²ç±»å‹ã€å‹ç¼©æ–¹å¼ç­‰ä¿¡æ¯ã€‚PNG æ ¼å¼çš„å›¾åƒæ˜¯ç”¨å­—èŠ‚çš„å½¢å¼ä¿å­˜çš„ï¼Œå¯ä»¥ç”¨å›¾ç‰‡æŸ¥çœ‹å™¨ç­‰è½¯ä»¶æ‰“å¼€ã€‚</p>
<p>Array æ ¼å¼æ˜¯æœ€åŸå§‹çš„å›¾åƒæ ¼å¼ï¼Œåœ¨å›¾åƒå¤„ç†æ—¶éƒ½éœ€è¦å°†å›¾ç‰‡è½¬æ¢æˆæ­¤æ ¼å¼ã€‚Array æ˜¯ä»¥å‘é‡çš„å½¢å¼å­˜å‚¨ï¼Œå½©è‰²å›¾åƒçš„æ¯ä¸ªåƒç´ ç‚¹éƒ½æœ‰ RGBï¼ˆçº¢ç»¿è“ï¼‰ä¸‰ä¸ªé€šé“ï¼Œæ‰€ä»¥å‘é‡çš„ç»´åº¦ä¸ºï¼šheight \times width\times 3ï¼›è€Œç°åº¦å›¾åƒæ¯ä¸ªåƒç´ ç‚¹ä»…æœ‰ä¸€ä¸ªé€šé“ï¼Œå‘é‡ç»´åº¦ä¸ºï¼šheight\times widthã€‚æ¯ä¸ªå€¼çš„å–å€¼èŒƒå›´æ˜¯ 0 ~ 255ï¼Œå…¶ä¸­0ä»£è¡¨äº®åº¦æœ€ä½ï¼Œ255ä»£è¡¨äº®åº¦æœ€é«˜ã€‚ä¾‹å¦‚ç¬¬iè¡Œç¬¬jåˆ—çš„åƒç´ æ˜¯çº¢è‰²çš„ï¼Œåˆ™æœ‰ <code>img_rgb[i, j, :]=[255, 0, 0]</code>ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ä½¿ç”¨ OpenCV åº“æ—¶ï¼Œå…¶é»˜è®¤çš„é€šé“é¡ºåºä¸º BGRï¼ˆè“ç»¿çº¢ï¼‰ï¼Œæ‰€ä»¥å½“å›¾åƒçš„ç¬¬iè¡Œç¬¬jåˆ—åƒç´ æ˜¯çº¢è‰²æ—¶ï¼Œåˆ™æœ‰ <code>img_rgb[i, j, :]=[0, 0, 255]</code>ã€‚</p>
<p>æµ®ç‚¹å‹æ ¼å¼çš„å›¾åƒåŒæ ·ä»¥å‘é‡çš„å½¢å¼ä¿å­˜ï¼Œç»´åº¦ä¸ºï¼šheight\times widthï¼Œæ¯ä¸ªåƒç´ ç‚¹çš„å€¼æ˜¯æµ®ç‚¹å‹ï¼Œé€‚åˆæ·±åº¦å›¾çš„ä¿å­˜ã€‚ä¾‹å¦‚ DepthPlanar å›¾åƒä¸­æ¯ä¸ªåƒç´ ç‚¹çš„å€¼è¡¨ç¤ºæ­¤åƒç´ ç‚¹åˆ°ç›¸å¹³é¢çš„è·ç¦»ã€‚</p>
<p>å°†è¿™3ç§å›¾ç‰‡ä¿å­˜æ ¼å¼çš„ç‰¹ç‚¹æ€»ç»“å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p>
<table>
<thead>
<tr>
<th>å›¾åƒç±»å‹</th>
<th>å­˜å‚¨å½¢å¼</th>
<th>æ˜¯å¦å‹ç¼©</th>
<th>é€‚åˆä¿å­˜çš„å›¾ç‰‡ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>PNG æ ¼å¼</td>
<td>bytes</td>
<td>æ— æŸå‹ç¼©</td>
<td>å½©è‰²å›¾ã€åˆ†å‰²å›¾ã€è¡¨é¢æ³•çº¿å›¾ã€çº¢å¤–å›¾</td>
</tr>
<tr>
<td>Array æ ¼å¼</td>
<td>bytes</td>
<td>æ— </td>
<td>å½©è‰²å›¾ã€åˆ†å‰²å›¾ã€è¡¨é¢æ³•çº¿å›¾ã€çº¢å¤–å›¾</td>
</tr>
<tr>
<td>æµ®ç‚¹å‹æ ¼å¼</td>
<td>float</td>
<td>æ— </td>
<td>æ·±åº¦å›¾</td>
</tr>
</tbody>
</table>
<p>é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¿›ä¸€æ­¥è¯´æ˜ï¼Œä¸‹é¢çš„ä»£ç å®ç°çš„åŠŸèƒ½æ˜¯ï¼šä½¿ç”¨åŒä¸€ä¸ªç›¸æœºåˆ†åˆ«è¯»å– 3 ç§ç±»å‹çš„å›¾ç‰‡ï¼š PNG æ ¼å¼å½©è‰²å›¾ã€Array æ ¼å¼å½©è‰²å›¾ã€æµ®ç‚¹å‹æ·±åº¦å›¾ï¼Œæœ€åæ‰“å°å‡ºå›¾ç‰‡çš„ä¸€äº›ä¿¡æ¯ã€‚</p>
<pre><code class="language-python">response = client.simGetImages([
    # png format
    airsim.ImageRequest(0, airsim.ImageType.Scene, pixels_as_float=False, compress=True),
    airsim.ImageRequest(0, airsim.ImageType.Scene, pixels_as_float=False, compress=False),
    airsim.ImageRequets(0, airsim.ImageType.DepthPlanar, pixels_as_float=True)
])

print(&quot;PNG æ ¼å¼å½©è‰²å›¾çš„å‰ 8 ä¸ªå­—èŠ‚ï¼š&quot;, np.frombuffer(response[0].image_date_uint8[0:8], np.uint8))
print(&quot;PNG æ ¼å¼å½©è‰²å›¾çš„å­—èŠ‚ä¸ªæ•°ï¼š&quot;, len(response[0].image_data_uint8))
print(&quot;Array æ ¼å¼å½©è‰²å›¾çš„å­—èŠ‚ä¸ªæ•°ï¼š&quot;, len(response[1].image_data_uint8))
print(&quot;æµ®ç‚¹å‹æ ¼å¼æ·±åº¦å›¾ä»»ä¸€åƒç´ çš„å€¼ï¼š&quot;, response[2].image_data_float[random.randint(0, 10000)])
</code></pre>
<h4><span id="å›¾ç‰‡æ–‡ä»¶çš„æ ¼å¼">å›¾ç‰‡æ–‡ä»¶çš„æ ¼å¼</span></h4>
<p>é¦–å…ˆè¦åŒºåˆ†å›¾åƒæ•°æ®ä¸å›¾ç‰‡æ–‡ä»¶çš„ä¸åŒã€‚</p>
<p>å›¾åƒæ•°æ®æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„æ•°æ®ï¼Œå¤§éƒ¨åˆ†æ˜¯åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™é€šè¿‡ API è¯»å–åˆ°çš„ï¼Œå¯ä»¥ä» AirSim APIs è·å¾—ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä»æ–‡ä»¶ä¸­è·å¾—ï¼Œå½“ç¨‹åºè¿è¡Œç»“æŸï¼Œæˆ–è€…å†…å­˜é‡Šæ”¾æ‰çš„æ—¶å€™ï¼Œè¿™äº›æ•°æ®ä¹Ÿå°±éšä¹‹æ¶ˆå¤±äº†ã€‚</p>
<p>å›¾ç‰‡æ–‡ä»¶æ˜¯ä¿å­˜åœ¨ç¡¬ç›˜ä¸­çš„æ–‡ä»¶ï¼Œæœ‰ä¸åŒçš„åç¼€åæ ¼å¼çš„æ–‡ä»¶ï¼Œå¯ä»¥ç”¨å›¾åƒæŸ¥çœ‹å™¨ç­‰è½¯ä»¶æ‰“å¼€ã€‚å¸¸ç”¨çš„å›¾ç‰‡æ–‡ä»¶æ ¼å¼æœ‰ï¼š</p>
<ul>
<li><code>.jpg</code> æ ¼å¼ï¼šä¸å¸¦é€æ˜é€šé“çš„æœ‰æŸå‹ç¼©æ ¼å¼ï¼Œå¹¿æ³›åº”ç”¨äºäº’è”ç½‘å’Œæ•°ç ç›¸æœºé¢†åŸŸï¼›</li>
<li><code>.png</code> æ ¼å¼ï¼šä¾¿æºå¼ç½‘ç»œå›¾å½¢ï¼Œæ— æŸå‹ç¼©çš„ä½å›¾ï¼Œæœ‰è¾ƒé«˜çš„å‹ç¼©æ¯”ï¼›</li>
<li><code>.tif</code> æ ¼å¼ï¼šéå¤±çœŸçš„å‹ç¼©æ ¼å¼ï¼Œå ç”¨ç©ºé—´è¾ƒå¤§ï¼Œé€šå¸¸ç”¨äºä¹¦ç±å’Œæµ·æŠ¥ç­‰æ•°ä¸“ä¸šçš„é¢†åŸŸ;</li>
<li><code>.bmp</code> æ ¼å¼:æ˜¯ Windows æ“ä½œç³»ç»Ÿä¸­çš„æ ‡å‡†å›¾åƒæ–‡ä»¶æ ¼å¼,é€šå¸¸ä¸å‹ç¼©,æ–‡ä»¶æ‰€å ç©ºé—´è¾ƒå¤§.</li>
</ul>

                    </div>
                
            </div>

            <div class="article-toc">
                
                    <div id="post-toc-card">
                        <div id="toc-card-style">
    <div id="toc-card-div">
        <div class="the-toc">
            
        <div id='toc'>
            <strong class="sidebar-title"> ç›®å½• </strong>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">0. AirSim APIs ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">1. æ§åˆ¶æ— äººæœºçš„èµ·é£å’Œé™è½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">2. æ§åˆ¶å››æ—‹ç¿¼çš„é£è¡Œï¼ˆcore APIï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">2.1 æ§åˆ¶æ ·ä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">2.2 å››æ—‹ç¿¼åº•å±‚é£æ§é€šé“ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">2.3 æ°´å¹³ä½ç½®æ§åˆ¶å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">2.4 åèˆªè§’æ§åˆ¶æ¨¡å¼è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">æƒ…å†µ1ï¼ˆä¸å…è®¸ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">æƒ…å†µ2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">æƒ…å†µ3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">æƒ…å†µ4</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">3. é€Ÿåº¦æ§åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">3.1 æ§åˆ¶æ ·ä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">3.2 ä»£ç è¯¦è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">3.3 é€Ÿåº¦æ§åˆ¶æ–¹æ³• API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">3.4 é€Ÿåº¦æ§åˆ¶è¯¯å·®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">4. å››æ—‹ç¿¼é£åœ†å½¢åŠç”»å›¾ API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">5. å¤šæ— äººæœºååŒé›†ç¾¤ç¼–é˜Ÿï¼ˆåˆ†å¸ƒå¼æ§åˆ¶ç®—æ³•ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">5.1 å¤šæ— äººæœºç¼–é˜Ÿæ§åˆ¶ç†è®º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">5.2 AirSim é›†ç¾¤ç¼–é˜Ÿå®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">ä¿®æ”¹ settings.json æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">ç¼–é˜Ÿç®—æ³•ä»£ç </span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">6. çŠ¶æ€è¯»å– API &amp; å¤šæ— äººæœºä½ç½®è¯»å–å‡½æ•°å°è£…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">6.1 æ— äººæœºçœŸå€¼çŠ¶æ€è¯»å– API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">6.2 æ— äººæœºçŠ¶æ€ä¼°è®¡å€¼è¯»å– API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">6.3 ä½ç½®è¯»å–å‡½æ•°å°è£…ï¼ˆé‡ç‚¹ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">7. èˆªè·¯ç‚¹é£è¡Œ API &amp; å¤šæ— äººæœºä½ç½®æ§åˆ¶å‡½æ•°å°è£…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">8. å›¾åƒ APIs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">8.1 æ‹æ‘„å›¾åƒå‰çš„åŸºæœ¬çŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">å›¾åƒä½ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">å›¾åƒç§ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">å›¾åƒæ•°æ®çš„æ ¼å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">å›¾ç‰‡æ–‡ä»¶çš„æ ¼å¼</span></a></li></ol></li></ol></li></ol>
        </div>
    
        </div>
    </div>
</div>
                    </div>
                
            </div>
        </div>

        <!-- è¿™é‡Œæ’å…¥è¯„è®ºåŒºå’Œé¡µè„š -->
        
            
            
            
            
        


    

</div>
            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2026 Cold Rain&#39;s Blog
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;ColdRain
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>

<canvas
    id="background"
    style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: -1"
></canvas>
<script src="/js/background.min.js"></script>

</html>
