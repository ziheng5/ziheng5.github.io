
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>åŸºäº PyTorch ä¸ Gym çš„ PPO ç®—æ³•å¤ç° | Cold Rain&#39;s Blog</title>
    <meta name="author" content="ColdRain" />
    <meta name="description" content="éŠ€ã®é¾ã®èƒŒã«ä¹—ã£ã¦..." />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/head.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/vs.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜ æµè§ˆå™¨é»˜è®¤å¼€å¯</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>COLD RAIN&#39;S BLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Homepage</span>
        </a>
        
        <a href="/2024/11/26/test">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories/%E6%9D%82%E8%B0%88">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags/%E6%9D%82%E8%B0%88">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/friends">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;COLD RAIN&#39;S BLOG</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Homepage</div>
                    </div>
                </a>
                
                <a href="/2024/11/26/test">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories/%E6%9D%82%E8%B0%88">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags/%E6%9D%82%E8%B0%88">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
                <a href="/friends">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-link fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    
    
        <!-- post éƒ¨åˆ†è®¾è®¡ -->

        <div class="article-wrap">

            
            <div class="article-content">
                
                <div>
                    <h1>åŸºäº PyTorch ä¸ Gym çš„ PPO ç®—æ³•å¤ç°</h1>
                </div>

                <div class="info">
                    <span class="date">
                        <span class="icon">
                            <i class="fa-solid fa-calendar fa-fw"></i>
                        </span>
                        2025/1/19
                    </span>

                    
                        <span class="category">
                            <a href="/categories/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/">
                                <span class="icon">
                                    <i class="fa-solid fa-bookmark fa-fw"></i>
                                </span>
                                å¼ºåŒ–å­¦ä¹ 
                            </a>
                        </span>
                    

                    
                        <span class="tags">
                            <span class="icon">
                                <i class="fa-solid fa-tags fa-fw"></i>
                            </span>
                            
                            
                                <span class="tag">
                                    
                                    <a href="/tags/PyTorch/" style="color: #ff7d73">
                                        PyTorch
                                    </a>
                                </span>
                            
                                <span class="tag">
                                    
                                    <a href="/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/" style="color: #ffa2c4">
                                        å¼ºåŒ–å­¦ä¹ 
                                    </a>
                                </span>
                            
                        </span>
                    
                </div>

                
                    <!-- æ˜¾ç¤ºæ–‡ç« ç‰¹æœ‰çš„æ¨¡å—ï¼ˆå¦‚æ ‡ç­¾ã€åˆ†ç±»ï¼‰ -->
                    <div class="content" v-pre>
                        
                        <blockquote>
<p>ğŸ¤ è¿™æ®µæ—¶é—´åœ¨å¸ˆå§çš„æ¨èä¸‹ï¼Œå­¦ä¹ äº†ç½‘ä¸Šå…³äºå¼ºåŒ–å­¦ä¹ çš„ PyTorch å®æˆ˜è§†é¢‘ï¼Œå°ç”Ÿè‡ªå·±ä¹Ÿæ˜¯è·Ÿç€è§†é¢‘å¤ç°äº†ä¸€é PPO ç®—æ³•ï¼Œäºæ˜¯å‡†å¤‡å†™ä¸€ç¯‡ Blog æ¥è®°å½•å­¦ä¹ å¿ƒå¾—</p>
<p>æ¡†æ¶ï¼š<strong>PyTorch</strong></p>
<p>æ¸¸æˆï¼š<strong>LunarLander-v2</strong></p>
<p>ä¸Šä¸€æ¬¡è¿è¡ŒæˆåŠŸæ—¶é—´ï¼š<strong>2025-01-20</strong></p>
<p>ï¼ˆæœ¬æ–‡é‡Œçš„ä»£ç æ˜¯å°ç”Ÿé‡æ–°æ‰‹æ‰“çš„ï¼Œæœªå¤åˆ¶ç²˜è´´ï¼Œå¯èƒ½å­˜åœ¨æ‹¼å†™é”™è¯¯ï¼Œæœ›è§è°…ï¼‰</p>
</blockquote>
<p><img src="/images/rl_practice/pic1" alt="pic1"></p>
<h1><span id="1-å¯¼å…¥å¿…è¦çš„åŒ…">1. ğŸ“¦ å¯¼å…¥å¿…è¦çš„åŒ…</span></h1>
<pre><code class="language-Python">import torch
import torch.nn as nn
from torch.distributions.categorical import Categorical
import gym
import numpy as np

# å¯¼å®ŒåŒ…ä¹‹åé¡ºæ‰‹å®šä¹‰ä¸€ä¸‹ device
device = torch.device(â€œcuda:0â€ if torch.cuda.is_available() else &quot;cpu&quot;)
</code></pre>
<p>âš ï¸ æ³¨æ„ï¼šä¸‹è½½ gym çš„æ—¶å€™ä¸€å®šè¦è®°å¾—å®‰è£…ä¸€ä¸‹ <code>box2d</code> åŒ…ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-Terminal">pip install box2d box2d-kengz
</code></pre>
<p>è¿™é‡Œé¡ºä¾¿åˆ—ä¸€ä¸‹ requirements:</p>
<ul>
<li><strong>pytorch</strong>: 2.5.0</li>
<li><strong>gym</strong>: 0.26.2</li>
<li><strong>box2d</strong>: 2.3.10</li>
<li><strong>box2d</strong>-kengz: 2.3.3</li>
<li><strong>numpy</strong>: 2.1.3</li>
</ul>
<h1><span id="2-æ„å»ºç¼“å­˜åŒº">2. ğŸ«™ æ„å»ºç¼“å­˜åŒº</span></h1>
<pre><code class="language-Python">class Memory:
    def __init__(self):
        # ç¼“å­˜åŒºï¼Œç”¨äºå­˜å‚¨å½“å‰ä¸€ä¸ª episode ä¸­çš„ç»éªŒ
        self.actions = []
        self.states = []
        self.logprobs = []
        self.rewards = []
        self.is_terminals = []

    def clear_memory(self):
        # æ¸…ç©ºç¼“å­˜
        del self.actions[:]
        del self.states[:]
        del self.logprobs[:]
        del self.rewards[:]
        del self.is_terminals[:]
</code></pre>
<h1><span id="3-æ„å»º-a2c-ç­–ç•¥ç½‘ç»œ">3. ğŸ§± æ„å»º A2C ç­–ç•¥ç½‘ç»œ</span></h1>
<pre><code class="language-Python">class ActorCritic(nn.Module):
    def __init__(self, state_dim, action_dim, n_latent_var):
        super(ActorCritic, self).__init__()

        # Actor ç½‘ç»œï¼š
        self.action_layer = nn.Sequential(
            nn.Linear(state_dim, n_latent_var),
            nn.Tanh(),  # ä½ é—®æˆ‘ä¸ºä»€ä¹ˆä¸ç”¨å…¶ä»–æ¿€æ´»å‡½æ•°ï¼Ÿæˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œå¾…ä¼šå„¿æŸ¥ä¸€ä¸‹ QWQ
            nn.Linear(n_latent_var, n_latent_var),
            nn.Tanh(),
            nn.Linear(n_latent_var, action_dim),
            nn.Softmax(dim=-1)  # è¿™é‡Œ dim=-1 ç›¸å½“äº dim=2ï¼Œå¯¹ actions è¿›è¡Œå½’ä¸€åŒ–å¤„ç†
        )

        # Critic ç½‘ç»œï¼š
        self.value_layer = nn.Sequential(
            nn.Linear(state_dim, n_latent_var),
            nn.Tanh(),
            nn.Linear(n_latent_var, n_latent_var),
            nn.Tanh(),
            nn.Linear(n_latent_var, 1)
        )
    
    def forward(self):
        # ä½ é—®è¿™é‡Œä¸ºä»€ä¹ˆç”¨ä¸åˆ° forwardï¼Ÿå¤§ç¬¨è›‹ï¼è¿™é‡Œæœ‰ä¸¤ä¸ªç½‘ç»œä½ æ€ä¹ˆå‰å‘ä¼ æ’­ï¼Ÿ
        raise NotImplementedError

    def act(self, state, memory):
        # æ ¹æ®å½“å‰çŠ¶æ€ s ç”Ÿæˆä¸‹ä¸€æ­¥åŠ¨ä½œ a
        state = torch.from_numpy(state).float().to(device)
        actions_probs = self.action_layer(state)
        dist = Categorical(actions_probs)
        action = dist.sample()

        # å‹å…¥ç¼“å­˜åŒº
        memory.states.append(state)
        memory.actions.append(action)
        memory.logprobs.append(dist.log_prob(action))

        return action.item()

    def evaluate(self, state, action):
        # è¯„ä¼°æ¨¡å¼
        action_probs = self.action_layer(state)
        dist = Categorical(action_probs)
        
        action_logprobs = dist.log_prob(action)
        dist_entropy = dist.entropy()

        state_value = self.value_layer(state)

        return action_logprobs, torch.squeeze(state_value), dist_entropy
</code></pre>
<p><code>ActorCritic</code> ç±»æ˜¯ PPO ç®—æ³•çš„æ ¸å¿ƒï¼Œå®ƒç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li><strong>Actor</strong>ï¼šç”¨äºæ ¹æ®å½“å‰çŠ¶æ€é€‰æ‹©åŠ¨ä½œã€‚é€šè¿‡ä¸€ä¸ªç¥ç»ç½‘ç»œæ¥é¢„æµ‹åŠ¨ä½œçš„æ¦‚ç‡åˆ†å¸ƒï¼Œå¹¶é€šè¿‡ <code>Categorical</code> ç±»æ¥æŠ½æ ·åŠ¨ä½œã€‚</li>
<li><strong>Critic</strong>ï¼šç”¨äºè¯„ä¼°å½“å‰çŠ¶æ€çš„ä»·å€¼ï¼Œé€šè¿‡ä¸€ä¸ªç¥ç»ç½‘ç»œè¾“å‡ºçŠ¶æ€çš„ä»·å€¼å‡½æ•°ã€‚</li>
</ul>
<p><code>act</code> æ–¹æ³•æ¥å—å½“å‰çŠ¶æ€ï¼Œè®¡ç®—å‡ºåŠ¨ä½œæ¦‚ç‡åˆ†å¸ƒå¹¶æ ¹æ®å…¶è¿›è¡ŒæŠ½æ ·ï¼Œä¿å­˜å½“å‰çš„çŠ¶æ€ã€åŠ¨ä½œå’Œå¯¹åº”çš„ log æ¦‚ç‡ã€‚</p>
<p><code>evaluate</code> æ–¹æ³•ç”¨äºè®¡ç®—åŠ¨ä½œçš„ log æ¦‚ç‡ã€çŠ¶æ€å€¼å’Œåˆ†å¸ƒçš„ç†µã€‚</p>
<h1><span id="4-æ„å»º-ppo-ç®—æ³•">4. ğŸ‘· æ„å»º PPO ç®—æ³•</span></h1>
<pre><code class="language-Python">class PPO:
    def __init__(self, state_dim, action_dim, n_latent_var, lr, betas, gamma, K_epochs, eps_clip):
        self.lr = lr
        self.betas = betas
        self.gamma = gamma
        self.eps_clip = eps_clip
        self.K_epochs = K_epochs

        # åˆ›å»ºç­–ç•¥ç½‘ç»œ
        self.policy = ActorCritic(state_dim, action_dim, n_latent_var).to(device)
        self.optimizer = torch.optim.Adam(self.policy.parameters(), lr=lr, betas=betas)

        # è¿™é‡Œä½¿ç”¨ off policy æ€æƒ³ï¼Œç»™æˆ‘ä»¬çš„ policy å¬å”¤ä¸€ä¸ªåˆ†èº«
        self.policy_old = ActorCritic(state_dim, action_dim, n_latent_var).to(device)
        self.policy_old.load_state_dict(self.policy.state_dict)

        self.MseLoss = nn.MSELoss()
    

    def update(self, memory):
        # åˆ©ç”¨è’™ç‰¹å¡æ´›ç®—æ³•è®¡ç®— state rewards:
        rewards = []
        discounted_reward = 0
        for reward, is_terminal in zip(reversed(memory.rewards), reversed(memory.is_terminal)):
            if is_terminal:
                discounted_reward = 0
            discounted_reward = reward + self.gamma * discounted_reward
            rewards.insert(0, discounted_reward)

        # å½’ä¸€åŒ– rewards
        rewards = torch.tensor(rewards, dtype=torch.float32).to(device)
        rewards = (rewards - rewards.mean()) / (rewards.std() + 1e-5)

        # æŠŠ list å…¨éƒ¨è½¬æ¢ä¸º tensor
        old_states = torch.stack(memory.states).to(device).detach()
        old_actions = torch.stack(memory.actions).to(device).detach()
        old_logprobs = torch.stack(memory.logprobs).to(device).detach()

        # ä¼˜åŒ–ç­–ç•¥
        for _ in range(self.K_epochs):
            # è¯„ä¼° old actions å’Œ values
            logprobs, state_values, dist_entropy = self.policy.evaluate(old_state, old_actions)

            # è®¡ç®— ratio (pi_theta / pi_theta_old)
            ratios = torch.exp(logprobs - old_logprobs.detach())

            # è®¡ç®— surrogate loss
            advantages = rewards - state_values.detach()
            surr1 = ratios * advantages
            surr2 = torch.clamp(ratios, 1.0-self.eps_clip, 1.0+self.eps_clip) * advantages
            loss = -torch.min(surr1, surr2) + 0.5*self.MseLoss(state_values, rewards) - 0.01*dist_entropy

            # æ›´æ–°æƒé‡
            self.optimizer.zero_grad()
            loss.mean().backward()
            self.optimizer.step()

        
        # å°†æ–°çš„æƒé‡èµ‹ç»™æˆ‘ä»¬çš„ old_policy
        self.policy_old.load_state_dict(self.policy.state_dict())
</code></pre>
<p><code>PPO</code> ç±»å°è£…äº†å¼ºåŒ–å­¦ä¹ è®­ç»ƒçš„ä¸»è¦é€»è¾‘ã€‚<br>
<code>update</code> æ–¹æ³•é€šè¿‡ç»éªŒå›æ”¾æ›´æ–°ç­–ç•¥ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œè®¡ç®—è’™ç‰¹å¡æ´›å¥–åŠ±ã€‚</li>
<li>ç„¶åå¯¹å¥–åŠ±å½’ä¸€åŒ–å¤„ç†ã€‚</li>
<li>æ¥ç€ï¼Œé€šè¿‡å¤šæ¬¡ä¼˜åŒ–ï¼ˆK-epochsï¼‰ï¼Œè®¡ç®—æŸå¤±å‡½æ•°å¹¶è¿›è¡Œæ¢¯åº¦æ›´æ–°ã€‚</li>
<li>æœ€åï¼Œå°†æ–°çš„ç­–ç•¥å‚æ•°å¤åˆ¶åˆ°æ—§ç­–ç•¥ä¸­ã€‚</li>
</ul>
<p>æŸå¤±å‡½æ•°ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li><strong>Surrogate Loss</strong>ï¼šç¡®ä¿æ–°çš„ç­–ç•¥å’Œæ—§çš„ç­–ç•¥ä¹‹é—´çš„æ¯”ç‡ ratio ä¸ä¾¿ï¼Œä»¥é¿å…è¿‡å¤§çš„ç­–ç•¥å˜åŒ–ã€‚</li>
<li><strong>Value Loss</strong>ï¼šé€šè¿‡å‡æ–¹è¯¯å·®æ¥æœ€å°åŒ–çŠ¶æ€ä»·å€¼çš„è¯¯å·®ã€‚</li>
<li><strong>Entropy</strong>ï¼šé€šè¿‡ç†µæ¥é¿å…ç­–ç•¥è¿‡äºç¡®å®šï¼Œä¿æŒæ¢ç´¢æ€§ã€‚</li>
</ul>
<h1><span id="5-ä¸»å‡½æ•°">5. ğŸ€„ ä¸»å‡½æ•°</span></h1>
<pre><code class="language-Python">def main():
    # åˆ›å»ºç¯å¢ƒ
    env_name = &quot;LunarLander-V2&quot;
    env = gym.make(env_name, render_name=&quot;human&quot;)

    #############################################################################
    # åˆå§‹åŒ–å‚æ•°
    state_dim = env.observation_space.shape[0]  # state_dim = 8
    action_dim = 4  # ä¸Šä¸‹å·¦å³
    render = True   # æ˜¯å¦å±•ç¤ºï¼ˆå»ºè®®è®¾ç½®ä¸º False,è¿™æ ·å¯ä»¥åŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼‰
    solved_reward = 230 # è®­ç»ƒæˆåŠŸçš„æŒ‡æ ‡
    log_interval = 20
    max_episodes = 50000
    max_timesteps = 300
    n_latent_var = 64
    update_timestep = 2000
    lr = 0.002
    betas = (0.9, 0.999)
    gamma = 0.99
    K_epochs = 4
    eps_clip = 0.2
    random_seed = None
    #############################################################################

    if random_seed:
        torch.manual_seed(random_seed)
        env.seed(random_seed)

    memory = Memory()
    ppo = PPO(state_dim, action_dim, n_latent_var, lr, betas, gamma, K_epochs, eps_clip)

    running_reward = 0
    avg_length = 0
    timestep = 0

    for i_episode in range(1, max_episodes+1):
        state = env.reset()
        state = np.array(state[0])
        for t in range(max_timesteps):
            timestep += 1

            action = ppo.policy_old.act(state, memory)
            state, reward, done, _, _ = env.step(action)
            # æ³¨æ„ï¼šæ–°ç‰ˆçš„ gym åœ¨ env.step æ—¶ä¼šè¿”å› 5 ä¸ªå€¼ï¼Œå…·ä½“è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£æˆ–æºç æ³¨é‡Š

            memory.rewards.append(reward)
            memory.is_terminals.append(done)

            if timestep % update_timestep == 0:
                ppo.update(memory)
                memory.clear_memory()
                timestep = 0

            running_reward += reward
            if render:
                env.render()
            if done:
                break
            
        avg_length += t

        if running_reward &gt; (log_interval*solved_reward):
            print(&quot;#################### Solved ! ####################&quot;)
            torch.save(ppo.policy.state_dict(), './PPO_&#123;&#125;.pth'.format(env.name))
            break

        if i_episode % log_interval == 0:
            avg_length = int(avg_length/log_interval)
            running_reward = int(running_reward/log_interval)

            print(&quot;Episode &#123;&#125; \t avg length: &#123;&#125; \t reward:&#123;&#125;&quot;.format(i_episode, avg_length, running_reward))
            running_reward = 0
            avg_length = 0
</code></pre>
<h1><span id="6-åŠ è½½æ¨¡å‹æ–‡ä»¶å±•ç¤ºæ•ˆæœ">6. ğŸš— åŠ è½½æ¨¡å‹æ–‡ä»¶å±•ç¤ºæ•ˆæœï¼š</span></h1>
<blockquote>
<p>è¿™é‡Œè¦æ–°å»ºä¸€ä¸ª <code>ppo_show.py</code> æ–‡ä»¶</p>
</blockquote>
<pre><code class="language-Python">from ppo import PPO, Memory, ActorCritic
import gym
import torch
import numpy as np

env_name = &quot;LunarLander-v2&quot;
env = gym.make(env_name, render_mode=&quot;human&quot;)
state_dim = env.observation_space.shape[0]
action_dim = 4
render = True
max_timesteps = 300
n_latent_var = 64
lr = 0.0007
betas = (0.9, 0.999)
gamma = 0.99
K_epochs = 4
eps_clip = 0.2
n_episodes = 3
filename = &quot;PPO_LunarLander-v2.pth&quot;
directory = &quot;./&quot;

memory = Memory()
ppo = PPO(state_dim, action_dim, n_latent_var, lr, betas, gamma, K_epochs, eps_clip=eps_clip)
ppo.policy.load_state_dict(torch.load(filename))
ppo.policy_old.load_state_dict(torch.load(filename))

# logging variables
running_reward = 0
avg_length = 0
timestep = 0

# training loop
for i_episode in range(1, 20):
    state = env.reset()
    state = np.array(state[0])
    for t in range(max_timesteps):
        timestep += 1

        action = ppo.policy_old.act(state, memory)
        state, reward, done, _, _ = env.step(action)

        memory.rewards.append(reward)
        memory.is_terminals.append(done)

        running_reward += reward
        if render:
            env.render()
        if done:
            break

    avg_length += t
</code></pre>
<blockquote>
<p><strong>å¦‚æœ‰æŠ¥é”™ä¸”æ‰¾ä¸åˆ°æŠ¥é”™åŸå› çš„ï¼Œå¯ä»¥ç§ä¿¡å°ç”Ÿ</strong> ğŸ¥º</p>
</blockquote>

                    </div>
                
            </div>

            <div class="article-toc">
                
                    <div id="post-toc-card">
                        <div id="toc-card-style">
    <div id="toc-card-div">
        <div class="the-toc">
            
        <div id='toc'>
            <strong class="sidebar-title"> ç›®å½• </strong>
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">1. ğŸ“¦ å¯¼å…¥å¿…è¦çš„åŒ…</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">2. ğŸ«™ æ„å»ºç¼“å­˜åŒº</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">3. ğŸ§± æ„å»º A2C ç­–ç•¥ç½‘ç»œ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">4. ğŸ‘· æ„å»º PPO ç®—æ³•</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">5. ğŸ€„ ä¸»å‡½æ•°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">6. ğŸš— åŠ è½½æ¨¡å‹æ–‡ä»¶å±•ç¤ºæ•ˆæœï¼š</span></a></li></ol>
        </div>
    
        </div>
    </div>
</div>
                    </div>
                
            </div>
        </div>

        <!-- è¿™é‡Œæ’å…¥è¯„è®ºåŒºå’Œé¡µè„š -->
        
            
            
            
            
        


    

</div>
            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2026 Cold Rain&#39;s Blog
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;ColdRain
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>

<canvas
    id="background"
    style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: -1"
></canvas>
<script src="/js/background.min.js"></script>

</html>
