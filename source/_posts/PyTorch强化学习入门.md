---
title: PyTorchå¼ºåŒ–å­¦ä¹ å…¥é—¨
date: 2024-12-11 13:02:25
tags: 
    - RLï¼ˆå¼ºåŒ–å­¦ä¹ ï¼‰
    - PyTorch
    - æ·±åº¦å­¦ä¹ 
categories: 
    - RLï¼ˆå¼ºåŒ–å­¦ä¹ ï¼‰å®æˆ˜ç¬”è®°
description: |
    ğŸ“– å¦‚ä½•ä½¿ç”¨ PyTorch è¿›è¡Œæ·±åº¦å­¦ä¹ ä¸å¼ºåŒ–å­¦ä¹ çš„å®è·µ
---
## 1. å¼ é‡
å¼ é‡æ˜¯æ‰€æœ‰DLå·¥å…·åŒ…çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚åå­—å¬èµ·æ¥å¾ˆç¥ç§˜ï¼Œä½†æœ¬è´¨ä¸Šå¼ é‡å°±æ˜¯ä¸€ä¸ªå¤šç»´æ•°ç»„ã€‚ç”¨æ•°å­¦çŸ¥è¯†æ¥ç±»æ¯”ï¼Œå•ä¸ªæ•°å­—å°±åƒç‚¹ï¼Œæ˜¯é›¶ç»´çš„ï¼Œå‘é‡å°±åƒçº¿æ®µï¼Œæ˜¯ä¸€ç»´çš„ï¼ŒçŸ©é˜µåˆ™æ˜¯äºŒç»´çš„å¯¹è±¡ã€‚ä¸‰ç»´æ•°å­—çš„é›†åˆå¯ä»¥ç”¨å¹³è¡Œå…­é¢ä½“è¡¨ç¤ºï¼Œä½†å®ƒä»¬ä¸åƒçŸ©é˜µä¸€æ ·æœ‰ç‰¹å®šçš„åç§°ã€‚æˆ‘ä»¬å¯ä»¥ç”¨â€œå¼ é‡â€æ¥è¡¨ç¤ºé«˜ç»´é›†åˆã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨DLä¸­æ‰€ä½¿ç”¨çš„å¼ é‡å’Œåœ¨å¼ é‡æ¼”ç®—æˆ–å¼ é‡ä»£æ•°ä¸­æ‰€ç”¨çš„å¼ é‡ç›¸æ¯”ï¼Œåªåœ¨éƒ¨åˆ†å±‚é¢ä¸Šç›¸å…³ã€‚åœ¨DLä¸­ï¼Œå¼ é‡æ˜¯ä»»æ„å¤šç»´çš„æ•°ç»„ï¼Œä½†åœ¨æ•°å­¦ä¸­ï¼Œå¼ é‡æ˜¯å‘é‡ç©ºé—´ä¹‹é—´çš„æ˜ å°„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥è¡¨ç¤ºä¸ºå¤šç»´æ•°ç»„ï¼Œä½†èƒŒåå…·æœ‰æ›´å¤šçš„è¯­ä¹‰ä¿¡æ¯ã€‚æ•°å­¦å®¶é€šå¸¸ä¼šå¯¹ä»»ä½•ä½¿ç”¨å…¬è®¤æ•°å­¦æœ¯è¯­æ¥å‘½åä¸åŒäº‹ç‰©çš„äººçš±çœ‰ï¼Œå› æ­¤è¦å½“å¿ƒï¼

### 1.1 åˆ›å»ºå¼ é‡
å¦‚æœä½ ç†Ÿæ‚‰ NumPy åº“ï¼Œé‚£ä½ åº”è¯¥çŸ¥é“å…¶ä¸»è¦ç›®çš„æ˜¯ä»¥é€šç”¨çš„æ–¹å¼å¤„ç†å¤šç»´æ•°ç»„ã€‚åœ¨ NumPy ä¸­ï¼Œè¿™æ ·çš„æ•°ç»„æ²¡è¢«ç§°ä¸ºå¼ é‡ï¼Œä½†äº‹å®ä¸Šï¼Œå®ƒä»¬å°±æ˜¯å¼ é‡ã€‚å¼ é‡åœ¨ç§‘å­¦è®¡ç®—ä¸­è¢«å¹¿æ³›ç”¨ä½œæ•°æ®çš„é€šç”¨å­˜å‚¨æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå½©å›¾ä¼šè¢«ç¼–ç æˆå…·æœ‰å®½åº¦ã€é«˜åº¦å’Œè‰²å€¼çš„ä¸‰ç»´å¼ é‡ã€‚

é™¤äº†ç»´åº¦ä¹‹å¤–ï¼Œå…ƒç´ ç±»å‹ä¹Ÿæ˜¯å¼ é‡çš„ç‰¹å¾ä¹‹ä¸€ã€‚PyTorchæ”¯æŒå…«ç§ç±»å‹ï¼ŒåŒ…æ‹¬ä¸‰ç§æµ®ç‚¹ç±»å‹ï¼ˆ16ä½ã€32ä½å’Œ64ä½ï¼‰å’Œäº”ç§æ•´æ•°ç±»å‹ï¼ˆæœ‰ç¬¦å·8ä½ã€æ— ç¬¦å·8ä½ã€16ä½ã€32ä½å’Œ64ä½ï¼‰ã€‚ä¸åŒç±»å‹çš„å¼ é‡ç”¨ä¸åŒçš„ç±»è¡¨ç¤ºï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯ `torch.FloatTensor`ï¼ˆå¯¹åº”32ä½æµ®ç‚¹ç±»å‹ï¼‰ã€`torch.ByteTensor`ï¼ˆæ— ç¬¦å·8ä½æ•´æ•°ï¼‰ã€`torch.LongTensor`ï¼ˆæœ‰ç¬¦å·64ä½æ•´æ•°ï¼‰ã€‚å…¶ä½™çš„å¯ä»¥åœ¨PyTorchçš„æ–‡æ¡£ä¸­æŸ¥åˆ°ã€‚

æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥åœ¨ PyTorch ä¸­åˆ›å»ºå¼ é‡ï¼š
- é€šè¿‡è°ƒç”¨æ‰€éœ€ç±»å‹çš„æ„é€ å‡½æ•°ã€‚
- é€šè¿‡å°† NumPy æ•°ç»„æˆ– Python åˆ—è¡¨è½¬æ¢ä¸ºå¼ é‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç±»å‹å°†ä»æ•°ç»„çš„ç±»å‹ä¸­è·å–ã€‚
- é€šè¿‡è¦æ±‚ PyTorch åˆ›å»ºå¸¦æœ‰ç‰¹å®šæ•°æ®çš„å¼ é‡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ `torch.zeros()` å‡½æ•°åˆ›å»ºä¸€ä¸ªå…¨ä¸ºé›¶çš„å¼ é‡ã€‚

ä¸‹é¢æ˜¯ä¸Šè¿°æ–¹æ³•çš„å®ç°æ–¹å¼ï¼š

```Python
>>> import torch
>>> import numpy as np
>>> a = torch.FloatTensor(3, 2)
>>> a
tensor([[0.0000e+00, 2.9468e-24],
        [7.1179e-23, 9.5008e-43],
        [9.5709e-43, 0.0000e+00]])
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯¼å…¥äº† PyTorch å’Œ NumPyï¼Œå¹¶åˆ›å»ºæœªåˆå§‹åŒ–çš„3Ã—2çš„å¼ é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ PyTorch ä¼šä¸ºå¼ é‡åˆ†é…å†…å­˜ï¼Œä½†ä¸è¿›è¡Œåˆå§‹åŒ–ã€‚è¦æ¸…é™¤å¼ é‡çš„å†…å®¹ï¼Œéœ€è¦ä½¿ç”¨ä»¥ä¸‹æ“ä½œï¼š

```Python
>>> a.zero_()
tensor([[0., 0.],
        [0., 0.],
        [0., 0.]])
```

å¼ é‡æœ‰ä¸¤ç§ç±»å‹çš„æ“ä½œï¼š**inplace** å’Œ **functional**ã€‚inplace æ“ä½œéœ€åœ¨å‡½æ•°åç§°å**é™„åŠ ä¸€ä¸ªä¸‹åˆ’çº¿ï¼Œä½œç”¨äºå¼ é‡çš„å†…å®¹ã€‚ç„¶åï¼Œä¼šè¿”å›å¯¹è±¡æœ¬èº«**ã€‚functionalæ“ä½œæ˜¯åˆ›å»ºä¸€ä¸ªå¼ é‡çš„å‰¯æœ¬ï¼Œå¯¹å…¶å‰¯æœ¬è¿›è¡Œä¿®æ”¹ï¼Œè€ŒåŸå§‹å¼ é‡ä¿æŒä¸å˜ã€‚ä»æ€§èƒ½å’Œå†…å­˜è§’åº¦æ¥çœ‹ã€inplace æ–¹å¼é€šå¸¸æ›´ä¸ºé«˜æ•ˆã€‚

é€šè¿‡å…¶æ„é€ å‡½æ•°åˆ›å»ºå¼ é‡çš„å¦ä¸€ç§æ–¹æ³•æ˜¯æä¾›Pythonå¯è¿­ä»£å¯¹è±¡ï¼ˆä¾‹å¦‚åˆ—è¡¨æˆ–å…ƒç»„ï¼‰ï¼Œå®ƒå°†è¢«ç”¨ä½œæ–°åˆ›å»ºå¼ é‡çš„å†…å®¹ï¼š

```Python
>>> torch.FloatTensor([[1, 2, 3], [3, 2, 1]])
tensor([[1., 2., 3.],
        [3., 2., 1.]])
```

ä¸‹é¢çš„ä»£ç ç”¨ NumPy åˆ›å»ºäº†ä¸€ä¸ªå…¨é›¶å¼ é‡ï¼š

```Python
>>> n = np.zeros(shape=(3, 2))
>>> n
array([[0., 0.],
       [0., 0.],
       [0., 0.]])
>>> b = torch.tensor(n)
>>> b
tensor([[0., 0.],
        [0., 0.],
        [0., 0.]], dtype=torch.float64)
```

`torch.tensor` æ–¹æ³•æ¥å— NumPy æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªé€‚å½“å½¢çŠ¶çš„å¼ é‡ã€‚åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç”±é›¶åˆå§‹åŒ–çš„ NumPy æ•°ç»„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ•°ç»„åˆ›å»ºä¸€ä¸ª doubleï¼ˆ64ä½æµ®ç‚¹æ•°ï¼‰æ•°ç»„ã€‚å› æ­¤ï¼Œç”Ÿæˆçš„å¼ é‡å…·æœ‰ `DoubleTensor` ç±»å‹ï¼ˆåœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ä½¿ç”¨ `dtype` å€¼æ˜¾ç¤ºï¼‰ã€‚åœ¨ DL ä¸­ï¼Œé€šå¸¸ä¸éœ€è¦åŒç²¾åº¦ï¼Œå› ä¸ºä½¿ç”¨åŒç²¾åº¦ä¼šå¢åŠ å†…å­˜å’Œæ€§èƒ½å¼€é”€ã€‚é€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨ 32 ä½æµ®ç‚¹ç±»å‹ï¼Œç”šè‡³ä½¿ç”¨ 16 ä½æµ®ç‚¹ç±»å‹ï¼Œè¿™å·²ç»èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚äº†ã€‚è¦åˆ›å»ºè¿™æ ·çš„å¼ é‡ï¼Œéœ€è¦æ˜ç¡®æŒ‡å®š NumPy æ•°ç»„çš„ç±»å‹ï¼š

```Python
>>> n = np.zeros(shape=(3, 2), dtype=np.float32)
>>> torch.tensor(n)
tensor([[0., 0.],
        [0., 0.],
        [0., 0.]])
```

ä½œä¸ºå¯é€‰é¡¹ï¼Œå¯ä»¥åœ¨ `dtype` å‚æ•°ä¸­å°†æ‰€éœ€å¼ é‡çš„ç±»å‹æä¾›ç»™ `torch.tensor` å‡½æ•°ã€‚ä½†æ˜¯ï¼Œè¯·å°å¿ƒï¼Œå› ä¸ºæ­¤å‚æ•°æœŸæœ›ä¼ å…¥ PyTorch ç±»å‹è§„èŒƒï¼Œè€Œä¸æ˜¯ NumPy ç±»å‹è§„èŒƒã€‚PyTorch ç±»å‹ä¿å­˜åœ¨ `torch` åŒ…ä¸­ï¼Œä¾‹å¦‚ `torch.float32` å’Œ `torch.uint8`ã€‚

```Python
>>> n = np.zeros(shape=(3, 2))
>>> torch.tensor(n, dtype=torch.float32)
tensor([[0., 0.],
        [0., 0.],
        [0., 0.]])
```

### 1.2 é›¶ç»´å¼ é‡
ä» 0.4.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒPyTorch å·²ç»æ”¯æŒäº†ä¸æ ‡é‡ç›¸å¯¹åº”çš„é›¶ç»´å¼ é‡ã€‚è¿™ç§å¼ é‡å¯èƒ½æ˜¯æŸäº›æ“ä½œï¼ˆä¾‹å¦‚å¯¹å¼ é‡ä¸­çš„æ‰€æœ‰å€¼æ±‚å’Œï¼‰çš„ç»“æœã€‚è¿™ç§æƒ…å†µä»¥å‰æ˜¯é€šè¿‡åˆ›å»ºç»´åº¦ä¸º 1 çš„å¼ é‡ï¼ˆå‘é‡ï¼‰æ¥å¤„ç†çš„ã€‚

è¯¥è§£å†³æ–¹æ¡ˆæ˜¯æœ‰æ•ˆçš„ï¼Œä½†å®ƒå¹¶ä¸ç®€å•ï¼Œå› ä¸ºéœ€è¦é¢å¤–çš„ç´¢å¼•æ‰èƒ½è®¿é—®å€¼ã€‚ç°åœ¨ï¼Œå·²ç»æ”¯æŒé›¶ç»´å¼ é‡å¹¶ç”±åˆé€‚çš„å‡½æ•°è¿”å›ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ `torch.tensor()` å‡½æ•°åˆ›å»ºã€‚ä¸ºäº†è®¿é—®è¿™ç§å¼ é‡çš„å®é™… Pythonå€¼ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„ `item()` æ–¹æ³•ï¼š

```Python
>>> a = torch.tensor([1, 2, 3])
>>> a
tensor([3, 2, 1])
>>> s = a.sum()
>>> s
tensor(6)
>>> s.item()
6
>>> torch.tensor(1)
tensor(1)
```

### 1.3 å¼ é‡æ“ä½œ
